
<!DOCTYPE html>
<html lang="pt-PT" class="dark">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath fill-rule='evenodd' d='M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-3.51 1.713-6.636 4.362-8.499a.75.75 0 01.819.162z' clip-rule='evenodd' /%3E%3Cpath fill-rule='evenodd' d='M11.03 2.5a.75.75 0 01.672 0l.353.176c.42.21.941.21 1.361 0l.353-.176a.75.75 0 01.672 0l.354.176c.419.21.94.21 1.36 0l.353-.176a.75.75 0 01.672 0l.354.176c.42.21.94.21 1.36 0l.353-.176a.75.75 0 01.672 0A10.5 10.5 0 0018 1.51a.75.75 0 01.445.894c-.43.963-.713 2.005-.862 3.088a.75.75 0 01-1.488-.221c.133-.97.38-1.912.72-2.774a.75.75 0 01.373-.374c.862-.34 1.804-.587 2.774-.72a.75.75 0 01.222 1.488c-1.083.15-2.125.432-3.088.862a.75.75 0 01-.894-.445A10.5 10.5 0 0022.5 6a.75.75 0 010 1.5c-.793 0-1.555.12-2.28.348a.75.75 0 01-.632-1.355c.78-.363 1.623-.543 2.412-.543a.75.75 0 010-1.5c-1.13 0-2.223.233-3.218.653a.75.75 0 01-.853-.574 9.012 9.012 0 00-1.25-2.035.75.75 0 01.573-.853A8.966 8.966 0 0018.75 3a.75.75 0 011.5 0c0 .858-.11 1.701-.318 2.51a.75.75 0 01-1.355.632c.162-.647.248-1.31.248-1.992a.75.75 0 011.5 0c0 1.05-.205 2.073-.586 3.023a.75.75 0 01-1.298.749c.31-.796.484-1.63.484-2.482a.75.75 0 011.5 0c0 1.29-.288 2.525-.82 3.645a.75.75 0 01-1.238.835c.44-.94.658-1.94.658-2.98a.75.75 0 011.5 0c0 1.5-.386 2.922-1.09 4.209a.75.75 0 01-1.171.91c.6-1.107.91-2.3.91-3.529a.75.75 0 011.5 0c0 .738-.094 1.46-.275 2.162a.75.75 0 01-1.45.365c.143-.574.225-1.168.225-1.777a.75.75 0 011.5 0c0 .817-.11 1.614-.323 2.382a.75.75 0 01-1.43.433c.174-.633.278-1.285.278-1.955a.75.75 0 011.5 0c0 .874-.124 1.728-.362 2.55a.75.75 0 01-1.41.488c.196-.68.312-1.383.312-2.108a.75.75 0 011.5 0c0 .91-.137 1.8-.398 2.656a.75.75 0 01-1.388.53c.216-.713.348-1.45.348-2.206a.75.75 0 011.5 0c0 .927-.148 1.834-.434 2.707a.75.75 0 01-1.365.572c.23-.74.37-1.503.37-2.28a.75.75 0 011.5 0c0 .928-.153 1.837-.446 2.71a.75.75 0 01-1.36.58c.233-.74.376-1.503.376-2.28a.75.75 0 011.498.044 10.502 10.502 0 01-9.74 6.456z' clip-rule='evenodd' /%3E%3C/svg%3E" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IDEA - Serviços de Urgência 24/7</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- LeafletJS for Interactive Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              'sans': ['Poppins', 'sans-serif'],
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-in-out',
              'blink': 'blink 1.2s infinite ease-in-out',
              'typing': 'typing 2s steps(30, end), blink-caret .75s step-end infinite',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: 0, transform: 'translateY(10px)' },
                '100%': { opacity: 1, transform: 'translateY(0)' },
              },
              blink: {
                '0%, 100%': { transform: 'scale(1)', opacity: 1 },
                '50%': { transform: 'scale(1.6)', opacity: 0.6 },
              },
              typing: {
                'from': { width: '0' },
                'to': { width: '100%' }
              },
              'blink-caret': {
                'from, to': { borderColor: 'transparent' },
                '50%': { borderColor: '#2563eb' },
              }
            },
          },
        },
      }
    </script>
    <style>
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #f1f1f1; }
      .dark ::-webkit-scrollbar-track { background: #1e293b; }
      ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
      .dark ::-webkit-scrollbar-thumb { background: #475569; }
      ::-webkit-scrollbar-thumb:hover { background: #555; }
      .dark ::-webkit-scrollbar-thumb:hover { background: #334155; }
      html { scroll-behavior: smooth; }
      
      /* Map Marker and Popup Styles */
      .blinking-marker {
        background-color: #2563eb; /* Tailwind blue-600 */
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 0 10px rgba(37, 99, 235, 0.8);
        animation: blink 1.2s infinite ease-in-out;
      }
      .leaflet-popup-content-wrapper {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }
      .dark .leaflet-popup-content-wrapper {
        background: #1e293b; /* slate-800 */
        color: #e2e8f0; /* slate-200 */
      }
      .leaflet-popup-tip {
        background: #fff;
      }
      .dark .leaflet-popup-tip {
        background: #1e293b;
      }
      .map-popup-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 4px;
        font-family: 'Poppins', sans-serif;
      }
      .map-popup-content .service-name {
        font-size: 1rem;
        font-weight: 700;
        color: #1e293b;
      }
      .dark .map-popup-content .service-name {
        color: #fff;
      }
      .map-popup-content .location-name {
        font-size: 0.9rem;
        color: #64748b; /* slate-500 */
      }
      .dark .map-popup-content .location-name {
        color: #94a3b8; /* slate-400 */
      }
      .map-popup-content .popup-button {
        background-color: #2563eb; /* blue-600 */
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.8rem;
        transition: background-color 0.2s;
        border: none;
        cursor: pointer;
      }
      .map-popup-content .popup-button:hover {
        background-color: #1d4ed8; /* blue-700 */
      }
      
      /* Typewriter effect for popup */
      .typewriter-container {
        display: inline-block;
      }
      .typewriter-effect {
        overflow: hidden;
        border-right: .1em solid #2563eb;
        white-space: nowrap;
        margin: 0 auto;
        animation: typing 2s steps(30, end), blink-caret .75s step-end infinite;
      }
      .leaflet-popup-pane {
        /* This prevents the typewriter animation from being cut off */
        overflow: visible !important;
      }

    </style>
  <script type="importmap">
  {
    "imports": {
      "@google/genai": "https://aistudiocdn.com/@google/genai@^1.22.0",
      "react": "https://esm.sh/react@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
    }
  }
  </script>
</head>
  <body class="bg-stone-100 dark:bg-slate-900">
    <div id="root"></div>
    <script type="module">
      import React, { useState, useEffect, useMemo, useCallback, useRef } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI, Type } from "@google/genai";

      // --- INÍCIO DO CÓDIGO DA APLICAÇÃO ---

      // !!! IMPORTANTE !!!
      // !!! SUBSTITUA "SUA_CHAVE_API_AQUI" PELA SUA CHAVE DA API DA GOOGLE GEMINI !!!
      const API_KEY = "SUA_CHAVE_API_AQUI";

      // --- HELPER DE CRIAÇÃO DE ELEMENTOS ---
      const h = React.createElement;

      // --- ÍCONES ---
      const WrenchScrewdriverIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M12 6.75a5.25 5.25 0 0 1 5.25 5.25c0 2.42-1.62 4.492-3.841 5.133a5.973 5.973 0 0 1-1.41.167H12A5.973 5.973 0 0 1 6 12c0-3.314 2.686-6 6-6zm.94-1.902a6.717 6.717 0 0 1 1.06 0 1.5 1.5 0 0 1 1.415 1.415 6.718 6.718 0 0 1 0 1.06 1.5 1.5 0 0 1-1.415 1.415 6.717 6.717 0 0 1-1.06 0 1.5 1.5 0 0 1-1.415-1.415 6.718 6.718 0 0 1 0-1.06A1.5 1.5 0 0 1 12.94 4.848zM12 1.5a10.5 10.5 0 1 0 0 21 10.5 10.5 0 0 0 0-21zM9.335 15.632a.75.75 0 0 1 .434 1.312l-2.368 1.184a.75.75 0 0 1-.98-.98l1.184-2.368a.75.75 0 0 1 1.312.434 2.459 2.459 0 0 0 .39 1.14 2.459 2.459 0 0 0 1.028.628z", clipRule: "evenodd" }));
      const UserGroupIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M4.5 6.375a4.125 4.125 0 1 1 8.25 0 4.125 4.125 0 0 1-8.25 0zM14.25 8.625a3.375 3.375 0 1 1 6.75 0 3.375 3.375 0 0 1-6.75 0zM5.25 9.75a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM6 12a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM7.5 11.25a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM9 12.75a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM10.5 12a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM12.75 5.625a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM12 4.5a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM14.25 15.75a4.125 4.125 0 1 1 8.25 0 4.125 4.125 0 0 1-8.25 0z" }), h('path', { fillRule: "evenodd", d: "M3 15.75a6.375 6.375 0 0 1 12.75 0h-1.5a4.875 4.875 0 0 0-9.75 0H3zM15 17.25a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM16.5 18a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM18.75 16.5a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM20.25 18.75a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75zM21 17.25a.75.75 0 0 0-1.5 0v.75a.75.75 0 0 0 1.5 0v-.75z", clipRule: "evenodd" }));
      const HomeModernIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M11.47 3.84a.75.75 0 0 1 1.06 0l8.69 8.69a.75.75 0 1 0 1.06-1.06l-8.689-8.69a2.25 2.25 0 0 0-3.182 0l-8.69 8.69a.75.75 0 1 0 1.061 1.06l8.69-8.69Z" }), h('path', { d: "M12 5.432 4.155 13.277a2.25 2.25 0 0 0-.655 1.584V18a2.25 2.25 0 0 0 2.25 2.25h12A2.25 2.25 0 0 0 20.25 18v-3.139a2.25 2.25 0 0 0-.655-1.584L12 5.432Z" }));
      const ScaleIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M2.25 3.527c0-.943.79-1.68 1.718-1.53l1.458.291c.362.072.723.18.988.322a4.49 4.49 0 0 1 1.348.919 4.512 4.512 0 0 1 .919 1.348c.142.265.25.626.322.988l.292 1.458c.15.928-.587 1.718-1.53 1.718H4.99c-.943 0-1.68-.79-1.53-1.718l.291-1.458a4.512 4.512 0 0 1 .322-.988 4.49 4.49 0 0 1 .919-1.348 4.512 4.512 0 0 1 1.348-.919c.265-.142.626-.25.988-.322l1.458-.292C12.443 1.987 13.5 3.057 13.5 4.125v15.75a.75.75 0 0 1-1.5 0V4.125c0-.181-.137-.33-.31-.345l-1.458-.291a3.012 3.012 0 0 0-2.23 2.23l-.292 1.458c-.015.072-.07.125-.145.125H3.75c-.075 0-.13-.053-.145-.125l-.292-1.458a3.012 3.012 0 0 0-2.23-2.23L-.085 4.815c-.173-.014-.31-.164-.31-.345V3.527Zm12.023 12.023c.943 0 1.68.79 1.53 1.718l-.291 1.458a4.512 4.512 0 0 1-.322.988 4.49 4.49 0 0 1-.919 1.348 4.512 4.512 0 0 1-1.348.919c-.265.142-.626.25-.988.322l-1.458.292c-.928.15-1.718-.587-1.718-1.53V19.01c0-.943.79-1.68 1.718-1.53l1.458.291c.362.072.723.18.988.322a3 3 0 0 0 2.23 2.23l.292 1.458c.015.072.07.125.145.125h.001c.075 0 .13-.053.145-.125l.292-1.458a3 3 0 0 0 2.23-2.23l.291-1.458c.15-.928-.587-1.718-1.53-1.718h-1.501Zm2.977-1.5a.75.75 0 0 0-1.5 0v1.502c0 .181.137.33.31.345l.292 1.458a4.49 4.49 0 0 1-2.23 2.23l-1.458.292c-.173.014-.31.164-.31.345v.943c0 .928.79 1.68 1.718 1.53l1.458-.292c.362-.072.723-.18.988-.322a4.49 4.49 0 0 0 1.348-.919 4.512 4.512 0 0 0 .919-1.348c.142-.265.25-.626.322-.988l.292-1.458c.15-.928-.587-1.718-1.53-1.718h-1.01Z", clipRule: "evenodd" }));
      const PaintBrushIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M11.625 1.5a2.25 2.25 0 0 1 2.25 2.25V7.5h-4.5V3.75a2.25 2.25 0 0 1 2.25-2.25Z" }), h('path', { d: "M11.625 1.5a.75.75 0 0 1 .75.75V3h-1.5V2.25a.75.75 0 0 1 .75-.75Z" }), h('path', { fillRule: "evenodd", d: "M19.5 7.5h-15a.75.75 0 0 0-.75.75v12a.75.75 0 0 0 .75.75h15a.75.75 0 0 0 .75-.75v-12a.75.75 0 0 0-.75-.75Zm-15 1.5h15V18h-15V9Zm-2.25-1.5a2.25 2.25 0 0 0-2.25 2.25v9.75a2.25 2.25 0 0 0 2.25 2.25h19.5a2.25 2.25 0 0 0 2.25-2.25V9.75a2.25 2.25 0 0 0-2.25-2.25H2.25Z", clipRule: "evenodd" }));
      const TruckIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M5.625 3.75a2.25 2.25 0 0 1 2.25 2.25v.75h-2.25a.75.75 0 0 0-.75.75v3a.75.75 0 0 0 .75.75h2.25v.75a2.25 2.25 0 0 1-2.25 2.25H3.75a.75.75 0 0 1-.75-.75V8.625a.75.75 0 0 0-.75-.75H1.5a.75.75 0 0 1-.75-.75V5.25a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 0 .75-.75V3.75Z" }), h('path', { fillRule: "evenodd", d: "M8.625 3.75a.75.75 0 0 1 .75.75v15a.75.75 0 0 1-.75.75H6.375a3 3 0 0 1-3-3V6.75a3 3 0 0 1 3-3h2.25ZM11.625 3a.75.75 0 0 0-.75.75v16.5a.75.75 0 0 0 .75.75h5.25a3.75 3.75 0 0 0 3.75-3.75V15a3 3 0 0 0-3-3h-1.5V5.25a2.25 2.25 0 0 0-2.25-2.25h-2.25Z", clipRule: "evenodd" }));
      const SunIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props }, h('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" }));
      const MoonIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props }, h('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" }));
      const MagnifyingGlassIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z", clipRule: "evenodd" }));
      const BoltIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", fill: "currentColor", ...props }, h('path', { d: "m3.182 17.818 13.636-13.636a1 1 0 0 0-1.414-1.414L1.768 16.404a1 1 0 0 0 1.414 1.414ZM2.5 10a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm8 3a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm-5-11a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Z" }));
      const CheckBadgeIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z", clipRule: "evenodd" }));
      const CreditCardIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", fill: "currentColor", ...props }, h('path', { d: "M2.5 4.5a3 3 0 0 0-3 3v5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3v-5a3 3 0 0 0-3-3h-15Z" }), h('path', { d: "M2.5 6.5a1 1 0 0 0-1 1v1.5a1.5 1.5 0 0 0 1.5 1.5h15a1.5 1.5 0 0 0 1.5-1.5v-1.5a1 1 0 0 0-1-1h-15Z" }));
      const GlobeAltIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", fill: "currentColor", ...props }, h('path', { d: "M10 2a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 10 2Z" }), h('path', { fillRule: "evenodd", d: "M10 20a10 10 0 1 0 0-20 10 10 0 0 0 0 20ZM9.25 4.75a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0v-1.5ZM5.636 6.364a.75.75 0 0 0-1.06-1.06l-1.061 1.06a.75.75 0 0 0 1.06 1.06l1.06-1.06ZM3.75 9.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5h-1.5Zm1.886 3.94a.75.75 0 0 0-1.06 1.06l1.06 1.061a.75.75 0 0 0 1.06-1.06l-1.06-1.061Zm4.614 3.06a.75.75 0 0 0 0-1.5v-1.5a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0ZM13.636 14.364a.75.75 0 0 0 1.06 1.06l1.061-1.06a.75.75 0 0 0-1.06-1.06l-1.06 1.061Zm2.614-3.114a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5h1.5Zm-1.886-3.94a.75.75 0 0 0 1.06-1.06l-1.06-1.061a.75.75 0 0 0-1.06 1.06l1.06 1.061Zm-4.614-3.06a.75.75 0 0 0 0 1.5v1.5a.75.75 0 0 0 1.5 0v-1.5a.75.75 0 0 0-1.5 0Z", clipRule: "evenodd" }));
      const StarIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M10.868 2.884c.321-.662 1.215-.662 1.536 0l1.82 3.755 4.137.602c.73.106 1.022.992.494 1.503l-2.994 2.918.707 4.12c.125.726-.638 1.282-1.296.953L10 15.175l-3.705 1.948c-.658.33-1.422-.227-1.296-.953l.707-4.12-2.994-2.918c-.528-.51-.236-1.397.494-1.503l4.137-.602 1.82-3.755Z", clipRule: "evenodd" }));
      const Spinner = () => h('div', { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto" });
      const LocationMarkerIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.1.4-.223.654-.369.255-.146.554-.315.856-.5.302-.185.623-.39 1.01-.634.387-.244.86-.546 1.445-1.011a8.87 8.87 0 002.42-3.86C17.947 8.822 18 8.434 18 8a8 8 0 10-16 0c0 .434.053.822.146 1.194a8.87 8.87 0 002.42 3.86c.584.465 1.058.767 1.445 1.01.387.245.708.45 1.01.635.302.185.6.354.856.5.254.146.468.269.654.369a5.741 5.741 0 00.281.14l.018.008.006.003zM10 11.25a3.25 3.25 0 100-6.5 3.25 3.25 0 000 6.5z", clipRule: "evenodd" }));
      const SparklesIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M9.315 7.584C12.195 3.883 16.695 1.5 21.75 1.5a.75.75 0 01.75.75c0 5.056-2.383 9.555-6.084 12.436A6.75 6.75 0 019.75 22.5a.75.75 0 01-.75-.75c0-5.056 2.383-9.555 6.084-12.436A6.75 6.75 0 019.315 7.584zM15 5.25a.75.75 0 00-1.5 0v3a.75.75 0 001.5 0v-3zM18.75 8.25a.75.75 0 00-1.5 0v3a.75.75 0 001.5 0v-3zM22.5 11.25a.75.75 0 00-1.5 0v3a.75.75 0 001.5 0v-3zM2.625 13.5a.75.75 0 01.75-.75h3a.75.75 0 010 1.5h-3a.75.75 0 01-.75-.75zM6.75 17.25a.75.75 0 00-1.5 0v3a.75.75 0 001.5 0v-3zM10.875 13.5a.75.75 0 01.75-.75h3a.75.75 0 010 1.5h-3a.75.75 0 01-.75-.75z", clipRule: "evenodd" }));
      const LightBulbIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.591a.75.75 0 11-1.06-1.06l1.591-1.591a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.803 17.803a.75.75 0 01-1.06 0l-1.591-1.591a.75.75 0 111.06-1.06l1.591 1.591a.75.75 0 010 1.06zM12 21.75a.75.75 0 01-.75-.75v-2.25a.75.75 0 011.5 0V21a.75.75 0 01-.75.75zM5.106 17.803a.75.75 0 010-1.06l1.591-1.591a.75.75 0 011.06 1.06l-1.591 1.591a.75.75 0 01-1.06 0zM2.25 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3a.75.75 0 01-.75-.75zM6.106 6.106a.75.75 0 011.06 0l1.591 1.591a.75.75 0 01-1.06 1.06L6.106 7.167a.75.75 0 010-1.06z" }));
      const BuildingStorefrontIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M12.378 1.602a.75.75 0 00-.756 0L3 7.225V21a.75.75 0 00.75.75h6a.75.75 0 00.75-.75v-7.5a.75.75 0 01.75-.75h3a.75.75 0 01.75.75V21a.75.75 0 00.75.75h6a.75.75 0 00.75-.75V7.225l-8.622-5.623zM16.5 18.75a.75.75 0 000-1.5h-3a.75.75 0 000 1.5h3z" }), h('path', { d: "M21 4.755a.75.75 0 00-1.08-.626l-8.311 5.421a1.5 1.5 0 01-1.218 0l-8.311-5.421A.75.75 0 003 4.755v-.011a.75.75 0 00.578-.679l.666-3.329A.75.75 0 014.99 0h14.02a.75.75 0 01.744.736l.666 3.329a.75.75 0 00.578.679v.01z" }));
      const BriefcaseIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75A2.25 2.25 0 0015.75 1.5h-2.25a.75.75 0 00-1.5 0v3a.75.75 0 01-1.5 0v-3a.75.75 0 00-.75-.75zM10.5 6a.75.75 0 00-1.5 0v3a.75.75 0 001.5 0v-3zM12 1.5a.75.75 0 01.75.75v3a.75.75 0 01-1.5 0v-3A.75.75 0 0112 1.5z" }), h('path', { fillRule: "evenodd", d: "M3 6.75A2.25 2.25 0 015.25 4.5h13.5A2.25 2.25 0 0121 6.75v10.5A2.25 2.25 0 0118.75 19.5H5.25A2.25 2.25 0 013 17.25V6.75zm15-1.5a.75.75 0 00-1.5 0v.75a.75.75 0 001.5 0v-.75zM5.25 6a.75.75 0 00-1.5 0v.75a.75.75 0 001.5 0V6z", clipRule: "evenodd" }));
      const ComputerDesktopIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M11.25 12.75a.75.75 0 000 1.5h1.5a.75.75 0 000-1.5h-1.5z" }), h('path', { fillRule: "evenodd", d: "M4.125 3C3.089 3 2.25 3.84 2.25 4.875v10.5C2.25 16.16 3.089 17 4.125 17h15.75c1.036 0 1.875-.84 1.875-1.875V4.875C21.75 3.839 20.911 3 19.875 3H4.125zM3.75 15.375V4.875c0-.207.168-.375.375-.375h15.75c.207 0 .375.168.375.375v10.5c0 .207-.168.375-.375.375H4.125c-.207 0-.375-.168-.375-.375zM6.75 18.75a.75.75 0 000 1.5h10.5a.75.75 0 000-1.5H6.75z", clipRule: "evenodd" }));
      const KeyIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M15.75 1.5a3 3 0 00-3 3V6a3 3 0 00-3 3v.75a3 3 0 00-3 3v3.75a3 3 0 003 3h3.75a3 3 0 003-3V9.75a3 3 0 00-3-3V6a3 3 0 003-3h.75a3 3 0 003-3h-3.75zM12.75 12.75a.75.75 0 00-1.5 0v1.5a.75.75 0 001.5 0v-1.5z", clipRule: "evenodd" }));
      const CakeIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M11.25 11.25a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75h-.01a.75.75 0 01-.75-.75v-.01z" }), h('path', { fillRule: "evenodd", d: "M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM11.663 20.133a8.25 8.25 0 100-16.5.75.75 0 00-1.06 1.06 6.75 6.75 0 110 14.382.75.75 0 001.06 1.06zM13.5 11.25a.75.75 0 00-.75.75v3a.75.75 0 001.5 0v-3a.75.75 0 00-.75-.75z", clipRule: "evenodd" }));
      const CameraIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M4.5 4.5a3 3 0 00-3 3v9a3 3 0 003 3h15a3 3 0 003-3v-9a3 3 0 00-3-3h-1.875a1.5 1.5 0 01-1.06-.44l-1.125-1.125a1.5 1.5 0 00-1.06-.44H9.75a1.5 1.5 0 00-1.06.44L7.563 7.06a1.5 1.5 0 01-1.06.44H4.5z" }), h('path', { d: "M12 11.25a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5zM12 13.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3z" }));
      const AcademicCapIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M11.765 4.413A1.5 1.5 0 0112.75 3h.5a1.5 1.5 0 011.485 1.413l1.22 6.101 4.341.217a.75.75 0 01.378 1.343l-4.117 3.414 1.464 4.863a.75.75 0 01-1.12 1.002L12 18.03l-4.21 2.34a.75.75 0 01-1.12-1.002l1.464-4.863-4.117-3.414a.75.75 0 01.378-1.343l4.341-.217 1.22-6.101z" }), h('path', { d: "M21.75 18c0 .414-.336.75-.75.75h-3.355a.75.75 0 01-.586-1.22l1.527-2.181a.75.75 0 00-1.22-.854L15.42 16.5a.75.75 0 01-.99 0l-1.946-1.947a.75.75 0 00-1.22.854l1.527 2.181A.75.75 0 0112.21 18.75H8.855a.75.75 0 01-.586-1.22l1.527-2.181a.75.75 0 10-1.22-.854L6.63 16.5a.75.75 0 01-.99 0l-1.946-1.947a.75.75 0 00-1.22.854l1.527 2.181A.75.75 0 013.355 18.75H.75a.75.75 0 01-.75-.75 3 3 0 013-3h15a3 3 0 013 3z" }));
      const MusicalNoteIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M10.5 4.5a.75.75 0 00-1.5 0v10.337A2.25 2.25 0 007.5 15a2.25 2.25 0 00-2.25 2.25c0 .53.184 1.01.494 1.393a.75.75 0 101.112-1.006A.75.75 0 017.5 16.5a.75.75 0 01.75-.75c.172 0 .332.058.468.156V4.5z" }), h('path', { d: "M16.5 3a.75.75 0 00-1.5 0v10.337A2.25 2.25 0 0013.5 13.5a2.25 2.25 0 00-2.25 2.25c0 .53.184 1.01.494 1.393a.75.75 0 101.112-1.006A.75.75 0 0113.5 15a.75.75 0 01.75-.75c.172 0 .332.058.468.156V3z" }));
      const HeartIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { d: "M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" }));
      const DogIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M16.22 10.34a.75.75 0 011.06 0 23.32 23.32 0 013.22 3.22.75.75 0 01-1.06 1.06 21.82 21.82 0 00-2.92-2.92.75.75 0 01-.29-.62V8.37a.75.75 0 111.5 0v1.22c0 .21.07.41.2.57zm-1.53 1.45a.75.75 0 01-1.06 0L12 10.16l-1.63 1.63a.75.75 0 01-1.06-1.06l2.16-2.16a.75.75 0 011.06 0l2.16 2.16a.75.75 0 010 1.06zM9.78 12.13a.75.75 0 01-1.06 0l-1.47-1.47v2.87a.75.75 0 01-1.5 0V8.37a.75.75 0 111.5 0v1.22c0 .21.07.41.2.57l1.33 1.97zM21 18.75a.75.75 0 00-1.5 0v.01a5.25 5.25 0 01-10.5 0v-.01a.75.75 0 00-1.5 0v.01a6.75 6.75 0 0013.5 0v-.01z", clipRule: "evenodd" }));
      const ChevronDownIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M12.53 16.28a.75.75 0 01-1.06 0l-7.5-7.5a.75.75 0 011.06-1.06L12 14.69l6.97-6.97a.75.75 0 111.06 1.06l-7.5 7.5z", clipRule: "evenodd" }));
      const ChevronUpIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M11.47 7.72a.75.75 0 011.06 0l7.5 7.5a.75.75 0 11-1.06 1.06L12 9.31l-6.97 6.97a.75.75 0 01-1.06-1.06l7.5-7.5z", clipRule: "evenodd" }));
      const WashingMachineIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M1.5 3.75A2.25 2.25 0 013.75 1.5h16.5A2.25 2.25 0 0122.5 3.75v16.5A2.25 2.25 0 0120.25 22.5H3.75A2.25 2.25 0 011.5 20.25V3.75zm3.75 2.25a.75.75 0 000 1.5h13.5a.75.75 0 000-1.5H5.25zM12 10.5a4.5 4.5 0 100 9 4.5 4.5 0 000-9zm-2.25 4.5a2.25 2.25 0 114.5 0 2.25 2.25 0 01-4.5 0z", clipRule: "evenodd" }));
      const CarIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M3.283 6.042a.75.75 0 01.99-.073l3.901 2.25a.75.75 0 010 1.326l-3.9 2.252a.75.75 0 01-.99-.072L.73 7.373a.75.75 0 010-1.326l2.552-1.475zM8.25 7.5a.75.75 0 01.75-.75h12a.75.75 0 01.75.75v10.5a.75.75 0 01-.75.75h-12a.75.75 0 01-.75-.75V7.5z", clipRule: "evenodd" }));
      const ScissorsIcon = (props) => h('svg', { xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 24 24", fill: "currentColor", ...props }, h('path', { fillRule: "evenodd", d: "M11.02 6.55a.75.75 0 011.06 0l3.25 3.25a.75.75 0 010 1.06l-3.25 3.25a.75.75 0 01-1.06-1.06l2.72-2.72-2.72-2.72a.75.75 0 010-1.06zM6.53 9.47a.75.75 0 010 1.06l-1.47 1.47a.75.75 0 01-1.06-1.06l1.47-1.47a.75.75 0 011.06 0zM12 1.5a.75.75 0 01.75.75v3a.75.75 0 01-1.5 0v-3a.75.75 0 01.75-.75zm0 15a.75.75 0 01.75.75v3a.75.75 0 01-1.5 0v-3a.75.75 0 01.75-.75z", clipRule: "evenodd" }));


      // --- CONSTANTES ---
      const SERVICE_CATEGORIES = [
        // Original
        { name: 'Canalizadores', icon: WrenchScrewdriverIcon },
        { name: 'Babysitters', icon: UserGroupIcon },
        { name: 'Pedreiros', icon: HomeModernIcon },
        { name: 'Advogados', icon: ScaleIcon },
        { name: 'Pintores', icon: PaintBrushIcon },
        { name: 'Mudanças', icon: TruckIcon },
        // Expanded
        { name: 'Eletricistas', icon: LightBulbIcon },
        { name: 'Limpeza Doméstica', icon: SparklesIcon },
        { name: 'Jardineiros', icon: BuildingStorefrontIcon },
        { name: 'Carpinteiros', icon: BriefcaseIcon },
        { name: 'Web Developers', icon: ComputerDesktopIcon },
        { name: 'Contabilistas', icon: BriefcaseIcon },
        { name: 'Serralheiros', icon: KeyIcon },
        { name: 'Catering', icon: CakeIcon },
        { name: 'Fotógrafos', icon: CameraIcon },
        { name: 'Explicações', icon: AcademicCapIcon },
        { name: 'Aulas de Música', icon: MusicalNoteIcon },
        { name: 'Personal Trainers', icon: HeartIcon },
        { name: 'Dog Walkers', icon: DogIcon },
        { name: 'Reparação de Eletrodomésticos', icon: WrenchScrewdriverIcon },
        { name: 'Montagem de Móveis', icon: WrenchScrewdriverIcon },
        { name: 'Designers Gráficos', icon: PaintBrushIcon },
        { name: 'Arquitetos', icon: HomeModernIcon },
        { name: 'Decoradores de Interiores', icon: HomeModernIcon },
        { name: 'Cuidados a Idosos', icon: HeartIcon },
        { name: 'Traduções', icon: GlobeAltIcon },
        { name: 'Organização de Eventos', icon: UserGroupIcon },
        { name: 'Técnicos de AVAC', icon: BoltIcon },
        { name: 'Estofadores', icon: BriefcaseIcon },
        { name: 'Serviços de TI', icon: ComputerDesktopIcon },
        { name: 'Reparação de Telemóveis', icon: ComputerDesktopIcon },
        { name: 'Videógrafos', icon: CameraIcon },
        { name: 'DJs', icon: MusicalNoteIcon },
        { name: 'Segurança', icon: CheckBadgeIcon },
        { name: 'Motoristas Particulares', icon: TruckIcon },
        { name: 'Consultoria de Negócios', icon: BriefcaseIcon },
        { name: 'Marketing Digital', icon: MagnifyingGlassIcon },
        { name: 'Nutricionistas', icon: HeartIcon },
        { name: 'Chef em Casa', icon: CakeIcon },
        { name: 'Lavagem de Carros', icon: SparklesIcon },
        { name: 'Controlo de Pragas', icon: BoltIcon },
        { name: 'Remodelações', icon: HomeModernIcon },
        { name: 'Isolamentos', icon: HomeModernIcon },
        { name: 'Polimento de Pavimentos', icon: SparklesIcon },
        { name: 'Reparação de Estores', icon: WrenchScrewdriverIcon },
        { name: 'Aulas de Culinária', icon: CakeIcon },
        { name: 'Apoio Administrativo', icon: BriefcaseIcon },
        { name: 'Limpeza Predial', icon: BuildingStorefrontIcon },
        { name: 'Lavandaria', icon: WashingMachineIcon },
        { name: 'Desinfestação', icon: BoltIcon },
        { name: 'Instalação de Ar Condicionado', icon: BoltIcon },
        { name: 'Reparação de Telhados', icon: HomeModernIcon },
        { name: 'Manicure/Pedicure', icon: SparklesIcon },
        { name: 'Cabeleireiro ao Domicílio', icon: ScissorsIcon },
        { name: 'Massagista', icon: HeartIcon },
        { name: 'Animação de Festas', icon: CakeIcon },
        { name: 'Florista', icon: SparklesIcon },
        { name: 'Mecânico de Automóveis', icon: CarIcon },
        { name: 'Reboque de Veículos', icon: TruckIcon },
        { name: 'Gestão de Redes Sociais', icon: GlobeAltIcon },
        { name: 'Aulas de Condução', icon: CarIcon },
        { name: 'Aulas de Yoga', icon: HeartIcon },
        { name: 'Aulas de Dança', icon: MusicalNoteIcon },
      ];
      const TESTIMONIALS = [
          { id: 1, client: 'Cliente Anónimo #3451', service: 'Canalização Urgente', rating: 5, comment: 'Serviço impecável e super rápido! O profissional chegou em 30 minutos e resolveu o problema da minha fuga de água. Recomendo vivamente!', avatar: `https://picsum.photos/seed/client1/100/100` },
          { id: 2, client: 'Cliente Anónimo #7823', service: 'Pintura de Apartamento', rating: 4.7, comment: 'A equipa foi muito profissional e o resultado final ficou excelente. Apenas um pequeno atraso no início, mas compensado pela qualidade.', avatar: `https://picsum.photos/seed/client2/100/100` },
          { id: 3, client: 'Cliente Anónimo #9012', service: 'Babysitting', rating: 5, comment: 'A Maria foi fantástica com os meus filhos. Chegou a horas, foi muito atenciosa e as crianças adoraram-na. Senti-me completamente segura.', avatar: `https://picsum.photos/seed/client3/100/100` },
          { id: 4, client: 'Cliente Anónimo #5548', service: 'Remodelação de Cozinha', rating: 4.9, comment: 'Projeto complexo, mas executado com grande mestria. A comunicação foi clara e o orçamento foi cumprido. Muito satisfeito.', avatar: `https://picsum.photos/seed/client4/100/100` },
      ];
      const SERVICE_PROVIDERS = [
          { id: 1, anonymousName: 'Canalizador Verificado #8532', service: 'Canalizadores', rating: 4.9, jobsCompleted: 152, tagline: 'Especialista em reparações urgentes e desentupimentos.', avatar: 'https://picsum.photos/seed/provider1/100/100' },
          { id: 2, anonymousName: 'Eletricista Verificado #7129', service: 'Eletricistas', rating: 4.8, jobsCompleted: 213, tagline: 'Instalações elétricas e resolução de avarias 24/7.', avatar: 'https://picsum.photos/seed/provider2/100/100' },
          { id: 3, anonymousName: 'Pintor Verificado #3341', service: 'Pintores', rating: 5.0, jobsCompleted: 88, tagline: 'Pintura interior e exterior com acabamentos perfeitos.', avatar: 'https://picsum.photos/seed/provider3/100/100' },
          { id: 4, anonymousName: 'Limpeza Verificada #5024', service: 'Limpeza Doméstica', rating: 4.7, jobsCompleted: 300, tagline: 'Serviços de limpeza profunda para residências e escritórios.', avatar: 'https://picsum.photos/seed/provider4/100/100' },
          { id: 5, anonymousName: 'Babysitter Verificada #1087', service: 'Babysitters', rating: 4.9, jobsCompleted: 120, tagline: 'Cuidado infantil de confiança para a sua tranquilidade.', avatar: 'https://picsum.photos/seed/provider5/100/100' },
          { id: 6, anonymousName: 'Carpinteiro Verificado #6521', service: 'Carpinteiros', rating: 4.6, jobsCompleted: 75, tagline: 'Móveis por medida e reparações em madeira.', avatar: 'https://picsum.photos/seed/provider6/100/100' },
          { id: 7, anonymousName: 'Jardineiro Verificado #2298', service: 'Jardineiros', rating: 4.8, jobsCompleted: 189, tagline: 'Manutenção de jardins e espaços verdes com paixão.', avatar: 'https://picsum.photos/seed/provider7/100/100' },
          { id: 8, anonymousName: 'Eletricista Verificado #4311', service: 'Eletricistas', rating: 4.5, jobsCompleted: 95, tagline: 'Reparações elétricas seguras e eficientes.', avatar: 'https://picsum.photos/seed/provider8/100/100' },
      ];
      const ALL_SERVICES = Array.from(new Set(SERVICE_CATEGORIES.map(s => s.name))).sort();
      const QUICK_PRICE_ESTIMATES = { Canalizadores: { min: 50, max: 200 }, Eletricistas: { min: 60, max: 250 }, Pedreiros: { min: 150, max: 800 }, Pintores: { min: 200, max: 1000 }, Carpinteiros: { min: 80, max: 400 }, Jardineiros: { min: 40, max: 150 }, 'Limpeza Doméstica': { min: 30, max: 100 }, Babysitters: { min: 25, max: 80 }, 'Dog Walkers': { min: 15, max: 50 }, 'Reparação de Eletrodomésticos': { min: 45, max: 180 }, 'Montagem de Móveis': { min: 50, max: 200 }, Advogados: { min: 100, max: 500 }, Contabilistas: { min: 80, max: 300 }, 'Designers Gráficos': { min: 150, max: 600 }, 'Web Developers': { min: 250, max: 1500 }, 'Mudanças e Transportes': { min: 100, max: 700 }, };
      const MAP_MARKER_DATA = [
        { city: 'Lisboa', lat: 38.7223, lng: -9.1393, service: 'Eletricistas' },
        { city: 'Porto', lat: 41.1579, lng: -8.6291, service: 'Canalizadores' },
        { city: 'Faro', lat: 37.0194, lng: -7.9304, service: 'Jardineiros' },
        { city: 'Coimbra', lat: 40.2033, lng: -8.4103, service: 'Pintores' },
        { city: 'Viseu', lat: 40.6575, lng: -7.9138, service: 'Carpinteiros' },
        { city: 'Funchal', lat: 32.6669, lng: -16.9085, service: 'Limpeza Doméstica' },
        { city: 'Ponta Delgada', lat: 37.7412, lng: -25.6756, service: 'Babysitters' },
        { city: 'Braga', lat: 41.5454, lng: -8.4265, service: 'Remodelações' },
        { city: 'Aveiro', lat: 40.6443, lng: -8.6455, service: 'Arquitetos' },
        { city: 'Évora', lat: 38.5714, lng: -7.9079, service: 'Advogados' }
      ];


      // --- SERVIÇO GEMINI API ---
      const getAiEstimate = async (formData) => {
        const ai = new GoogleGenAI({ apiKey: API_KEY });
        const prompt = `Age como um estimador de custos para serviços em Portugal. Com base nos seguintes detalhes, forneça uma estimativa de preço em Euros.
- Tipo de Serviço: ${formData.service}
- Urgência: ${formData.urgency} (${formData.urgency === 'urgente' ? 'taxa de urgência pode ser aplicada' : 'agendamento normal'})
- Localização (cidade/região): ${formData.location}
- Descrição do Trabalho: ${formData.description}
Forneça a sua resposta estritamente no formato JSON, seguindo o schema fornecido. O custo deve ser um intervalo (mínimo e máximo). A desagregação deve incluir itens como 'Mão de obra', 'Materiais (se aplicável)', 'Deslocação', 'Taxa de Urgência (se aplicável)'. As notas devem incluir quaisquer suposições que fez.`;

        try {
            const response = await ai.models.generateContent({
                model: "gemini-2.5-flash",
                contents: prompt,
                config: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: Type.OBJECT,
                        properties: {
                            estimated_cost_min: { type: Type.NUMBER },
                            estimated_cost_max: { type: Type.NUMBER },
                            currency: { type: Type.STRING },
                            breakdown: { type: Type.ARRAY, items: { type: Type.OBJECT, properties: { item: { type: Type.STRING }, cost: { type: Type.STRING } }, required: ["item", "cost"] } },
                            notes: { type: Type.STRING }
                        },
                        required: ["estimated_cost_min", "estimated_cost_max", "currency", "breakdown", "notes"]
                    },
                },
            });
            const jsonResponse = JSON.parse(response.text);
            return jsonResponse;
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            throw new Error("Não foi possível obter uma estimativa da IA. O serviço pode estar temporariamente indisponível.");
        }
      };
      
      // --- MODAL GENÉRICO ---
      const Modal = ({ isOpen, onClose, children }) => {
        if (!isOpen) return null;
        return h('div', { className: "fixed inset-0 bg-black bg-opacity-60 z-[1000] flex justify-center items-center", onClick: onClose },
            h('div', { className: "bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-4 sm:p-6 md:p-8 w-11/12 max-w-4xl max-h-[90vh] overflow-y-auto relative", onClick: e => e.stopPropagation() },
                h('button', { onClick: onClose, className: "absolute top-4 right-4 text-stone-500 hover:text-stone-800 dark:text-stone-400 dark:hover:text-white transition text-3xl leading-none" }, "×"),
                children
            )
        );
      };

      // --- COMPONENTES DE FORMULÁRIO ---
      const FormInput = ({ name, placeholder, required, value, onChange, onBlur, error, type = "text" }) => {
          return h('div', { className: "w-full"},
              h('input', { 
                  type, 
                  name, 
                  placeholder: required ? `${placeholder} *` : placeholder, 
                  required, 
                  value, 
                  onChange, 
                  onBlur,
                  className: `w-full p-3 border ${error ? 'border-red-500' : 'border-stone-300 dark:border-slate-600'} rounded-md bg-white dark:bg-slate-700 focus:ring-2 ${error ? 'focus:ring-red-500' : 'focus:ring-blue-500'} focus:border-transparent outline-none`
              }),
              error && h('p', { className: "text-red-500 text-xs mt-1" }, error)
          );
      };

      const FileInput = ({ id, name, label, onChange, file, required = false, error }) => {
          return h('div', null,
              h('label', { className: "block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1" }, label, required && h('span', { className: "text-red-500" }, " *")),
              h('div', { className: `mt-1 flex justify-center px-6 pt-5 pb-6 border-2 ${error ? 'border-red-500' : 'border-stone-300 dark:border-slate-600'} border-dashed rounded-md` },
                  h('div', { className: "space-y-1 text-center" },
                      h('svg', { className: "mx-auto h-12 w-12 text-stone-400", stroke: "currentColor", fill: "none", viewBox: "0 0 48 48", "aria-hidden": "true" },
                          h('path', { d: "M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" })
                      ),
                      h('div', { className: "flex text-sm text-stone-600 dark:text-stone-400" },
                          h('label', { htmlFor: id, className: "relative cursor-pointer bg-white dark:bg-slate-700 rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500" },
                              h('span', null, "Carregar ficheiro"),
                              h('input', { id: id, name: name, type: "file", className: "sr-only", onChange: onChange, accept: ".pdf,.jpg,.jpeg,.png" })
                          ),
                          h('p', { className: "pl-1" }, "ou arraste e solte")
                      ),
                      h('p', { className: "text-xs text-stone-500 dark:text-stone-500" }, "PDF, PNG, JPG até 10MB"),
                      file && h('p', { className: "text-sm font-semibold text-green-600 dark:text-green-400 pt-2" }, file.name),
                      error && !file && h('p', { className: "text-red-500 text-xs mt-1" }, error)
                  )
              )
          );
      };

      const FormStatus = ({ status, message }) => {
          if (!status) return null;
          const isSuccess = status === 'success';
          const bgColor = isSuccess ? 'bg-green-100 dark:bg-green-900/50' : 'bg-red-100 dark:bg-red-900/50';
          const borderColor = isSuccess ? 'border-green-500' : 'border-red-500';
          const textColor = isSuccess ? 'text-green-700 dark:text-green-300' : 'text-red-700 dark:text-red-300';
          return h('div', { className: `${bgColor} border-l-4 ${borderColor} ${textColor} p-4 rounded-md my-4` },
              h('p', { className: "font-bold" }, isSuccess ? 'Sucesso!' : 'Erro!'),
              h('p', null, message)
          );
      };

      // --- MODAL DE REGISTO ---
      const RegistrationModal = ({ isOpen, onClose }) => {
        const [view, setView] = useState('select');
        const FORMSPREE_ENDPOINT = "https://formspree.io/f/movnrrzj";
    
        const handleClose = () => {
            onClose();
            setTimeout(() => setView('select'), 300);
        };
    
        const ClientRegistrationForm = ({ onBack }) => {
            const [formData, setFormData] = useState({ fullName: '', address: '', nif: '' });
            const [files, setFiles] = useState({ idDocument: null, addressProof: null });
            const [errors, setErrors] = useState({});
            const [touched, setTouched] = useState({});
            const [status, setStatus] = useState(null);

            const validateField = (name, value) => {
              let error = '';
              if (typeof value === 'string' && !value.trim()) error = 'Este campo é obrigatório.';
              else if (name === 'nif' && !/^\d{9}$/.test(value)) error = 'O NIF deve ter 9 dígitos.';
              return error;
            };

            const validateFile = (name, file) => {
              let error = '';
              if (!file) error = 'É necessário carregar este documento.';
              return error;
            }

            const handleChange = (e) => {
              const { name, value } = e.target;
              setFormData(prev => ({ ...prev, [name]: value }));
              if (touched[name]) {
                  setErrors(prev => ({ ...prev, [name]: validateField(name, value) }));
              }
            };
            
            const handleBlur = (e) => {
                const { name, value } = e.target;
                setTouched(prev => ({ ...prev, [name]: true }));
                setErrors(prev => ({ ...prev, [name]: validateField(name, value) }));
            }

            const handleFileChange = (e) => {
              const { name, files: selectedFiles } = e.target;
              const file = selectedFiles && selectedFiles.length > 0 ? selectedFiles[0] : null;
              setFiles(prev => ({ ...prev, [name]: file }));
              setTouched(prev => ({...prev, [name]: true}));
              setErrors(prev => ({ ...prev, [name]: validateFile(name, file) }));
            };

            const isFormValid = useMemo(() => {
                const dataIsValid = Object.keys(formData).every(key => !validateField(key, formData[key]));
                const filesAreValid = Object.keys(files).every(key => !validateFile(key, files[key]));
                return dataIsValid && filesAreValid;
            }, [formData, files]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                const newErrors = {};
                const allFields = {...formData, ...files};
                Object.keys(allFields).forEach(key => touched[key] = true);
                setTouched(touched);

                Object.keys(formData).forEach(key => newErrors[key] = validateField(key, formData[key]));
                Object.keys(files).forEach(key => newErrors[key] = validateFile(key, files[key]));
                setErrors(newErrors);

                if (Object.values(newErrors).some(e => e)) return;

                setStatus('submitting');
                const data = new FormData();
                data.append('form-type', 'Cliente Registration');
                Object.entries(formData).forEach(([key, value]) => data.append(key, value));
                Object.entries(files).forEach(([key, value]) => { if (value) data.append(key, value) });

                try {
                    const response = await fetch(FORMSPREE_ENDPOINT, { method: 'POST', body: data, headers: { 'Accept': 'application/json' } });
                    if (response.ok) setStatus('success'); else setStatus('error');
                } catch (error) { setStatus('error'); }
            };

            if (status === 'success') {
                return h('div', { className: "text-center p-8" },
                    h('h2', { className: "text-2xl font-bold text-stone-800 dark:text-white mb-4" }, "Registo Enviado!"),
                    h('p', { className: "text-stone-600 dark:text-stone-300" }, "Obrigado pelo seu registo. Entraremos em contacto em breve para finalizar o processo.")
                );
            }

            return h('form', { onSubmit: handleSubmit, noValidate: true, className: "space-y-4" },
                h('h2', { className: "text-2xl font-bold text-center text-stone-800 dark:text-white" }, "Registo de Cliente"),
                h(FormInput, { name: "fullName", placeholder: "Nome Completo", required: true, value: formData.fullName, onChange: handleChange, onBlur: handleBlur, error: touched.fullName && errors.fullName }),
                h(FormInput, { name: "address", placeholder: "Endereço Completo", required: true, value: formData.address, onChange: handleChange, onBlur: handleBlur, error: touched.address && errors.address }),
                h(FormInput, { name: "nif", placeholder: "NIF", required: true, value: formData.nif, onChange: handleChange, onBlur: handleBlur, error: touched.nif && errors.nif }),
                h(FileInput, { id: "idDocumentClient", name: "idDocument", label: "Cópia do Cartão de Cidadão", required: true, file: files.idDocument, onChange: handleFileChange, error: touched.idDocument && errors.idDocument }),
                h(FileInput, { id: "addressProofClient", name: "addressProof", label: "Comprovativo de Morada", required: true, file: files.addressProof, onChange: handleFileChange, error: touched.addressProof && errors.addressProof }),
                status === 'error' && h(FormStatus, { status: "error", message: "Ocorreu um erro ao enviar o seu registo. Por favor, tente novamente." }),
                h('div', { className: "flex items-center justify-between gap-4 pt-4" },
                    h('button', { type: "button", onClick: onBack, className: "bg-stone-200 dark:bg-slate-700 text-stone-800 dark:text-stone-200 px-6 py-2 rounded-md font-semibold hover:bg-stone-300 dark:hover:bg-slate-600 transition" }, "Voltar"),
                    h('button', { type: "submit", disabled: !isFormValid || status === 'submitting', className: "bg-blue-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-700 transition disabled:bg-blue-400 disabled:cursor-not-allowed" }, status === 'submitting' ? 'A Enviar...' : 'Registar')
                )
            );
        };

        const CompanyRegistrationForm = ({ onBack }) => {
            const [formData, setFormData] = useState({ companyName: '', managerName: '', nif: '', address: '', contact: '', plan: 'normal' });
            const [files, setFiles] = useState({ idDocument: null, addressProof: null, businessProof: null });
            const [errors, setErrors] = useState({});
            const [touched, setTouched] = useState({});
            const [status, setStatus] = useState(null);

            const validateField = (name, value) => {
                let error = '';
                if (typeof value === 'string' && !value.trim()) {
                    error = 'Este campo é obrigatório.';
                } else {
                    switch (name) {
                        case 'nif':
                            if (!/^\d{9}$/.test(value)) error = 'O NIF deve ter 9 dígitos.';
                            break;
                        case 'contact':
                            const isEmail = value.includes('@');
                            if (isEmail) {
                                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) error = 'Formato de email inválido.';
                            } else {
                                if (!/^\d{9}$/.test(value.replace(/\s/g, ''))) error = 'O telefone deve ter 9 dígitos.';
                            }
                            break;
                    }
                }
                return error;
            };

            const validateFile = (name, file) => !file ? 'É necessário carregar este documento.' : '';

            const handleChange = e => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
                if (touched[name]) {
                    setErrors(prev => ({ ...prev, [name]: validateField(name, value) }));
                }
            };
            
            const handleBlur = (e) => {
                const { name, value } = e.target;
                setTouched(prev => ({ ...prev, [name]: true }));
                setErrors(prev => ({ ...prev, [name]: validateField(name, value) }));
            };

            const handleFileChange = e => {
                const { name, files: selectedFiles } = e.target;
                const file = selectedFiles && selectedFiles.length > 0 ? selectedFiles[0] : null;
                setFiles(prev => ({ ...prev, [name]: file }));
                setTouched(prev => ({...prev, [name]: true}));
                setErrors(prev => ({ ...prev, [name]: validateFile(name, file) }));
            };

            const isFormValid = useMemo(() => {
                const dataIsValid = Object.keys(formData).every(key => !validateField(key, formData[key]));
                const filesAreValid = Object.keys(files).every(key => !validateFile(key, files[key]));
                return dataIsValid && filesAreValid;
            }, [formData, files]);

            const handleSubmit = async e => {
                e.preventDefault();
                const newErrors = {};
                const allFields = {...formData, ...files};
                Object.keys(allFields).forEach(key => touched[key] = true);
                setTouched(touched);

                Object.keys(formData).forEach(key => newErrors[key] = validateField(key, formData[key]));
                Object.keys(files).forEach(key => newErrors[key] = validateFile(key, files[key]));
                setErrors(newErrors);

                if (Object.values(newErrors).some(e => e)) return;
                
                setStatus('submitting');
                const data = new FormData();
                data.append('form-type', 'Empresa Registration');
                Object.entries(formData).forEach(([key, value]) => data.append(key, value));
                Object.entries(files).forEach(([key, value]) => { if (value) data.append(key, value) });

                try {
                    const response = await fetch(FORMSPREE_ENDPOINT, { method: 'POST', body: data, headers: { 'Accept': 'application/json' } });
                    if (response.ok) setStatus('success'); else setStatus('error');
                } catch (error) { setStatus('error'); }
            };
        
            if (status === 'success') {
                return h('div', { className: "text-center p-8" },
                    h('h2', { className: "text-2xl font-bold text-stone-800 dark:text-white mb-4" }, "Registo Enviado!"),
                    h('p', { className: "text-stone-600 dark:text-stone-300" }, "Obrigado pelo seu registo. A sua candidatura será analisada e entraremos em contacto em breve."),
                    h('p', { className: "text-sm text-stone-500 dark:text-stone-400 mt-2" }, "Lembre-se: os primeiros 6 meses são grátis (excluindo comissões de serviço).")
                );
            }
        
            const planDetails = {
                normal: { title: 'Normal', price: '10€', features: 'Acesso a pedidos' },
                profissional: { title: 'Profissional', price: '20€', features: 'Destaque nas pesquisas' },
                vip: { title: 'VIP', price: '35€', features: 'Acesso a todos os pedidos' }
            };

            return h('form', { onSubmit: handleSubmit, noValidate: true, className: "space-y-4" },
                h('h2', { className: "text-2xl font-bold text-center text-stone-800 dark:text-white" }, "Registo de Empresa / Profissional"),
                h('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                    h(FormInput, { name: "companyName", placeholder: "Nome da Empresa", required: true, value: formData.companyName, onChange: handleChange, onBlur: handleBlur, error: touched.companyName && errors.companyName }),
                    h(FormInput, { name: "managerName", placeholder: "Nome do Gerente/Patrão", required: true, value: formData.managerName, onChange: handleChange, onBlur: handleBlur, error: touched.managerName && errors.managerName }),
                    h(FormInput, { name: "nif", placeholder: "NIF Empresarial", required: true, value: formData.nif, onChange: handleChange, onBlur: handleBlur, error: touched.nif && errors.nif }),
                    h(FormInput, { name: "contact", placeholder: "Contacto (Telefone/Email)", required: true, value: formData.contact, onChange: handleChange, onBlur: handleBlur, error: touched.contact && errors.contact })
                ),
                h(FormInput, { name: "address", placeholder: "Endereço da Empresa", required: true, value: formData.address, onChange: handleChange, onBlur: handleBlur, error: touched.address && errors.address }),
                h('div', { className: "space-y-4" },
                    h('h3', { className: "text-lg font-semibold text-stone-800 dark:text-white" }, "Validação de Documentos"),
                    h('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                        h(FileInput, { id: "idDocumentCompany", name: "idDocument", label: "BI/Cartão Cidadão", required: true, file: files.idDocument, onChange: handleFileChange, error: touched.idDocument && errors.idDocument }),
                        h(FileInput, { id: "addressProofCompany", name: "addressProof", label: "Comprovativo Morada", required: true, file: files.addressProof, onChange: handleFileChange, error: touched.addressProof && errors.addressProof }),
                        h(FileInput, { id: "businessProofCompany", name: "businessProof", label: "Comprovativo Empresa", required: true, file: files.businessProof, onChange: handleFileChange, error: touched.businessProof && errors.businessProof })
                    )
                ),
                h('div', null,
                    h('h3', { className: "text-lg font-semibold text-stone-800 dark:text-white mb-2" }, "Escolha o seu Plano"),
                    h('p', { className: "text-sm text-stone-500 dark:text-stone-400 mb-4" }, "Os primeiros 6 meses são grátis! Após o período de teste, será aplicada a mensalidade do plano escolhido."),
                    h('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                        Object.keys(planDetails).map(plan => h('label', { key: plan, className: "relative block" },
                            h('input', { type: "radio", name: "plan", value: plan, checked: formData.plan === plan, onChange: handleChange, className: "sr-only peer" }),
                            h('div', { className: "p-4 border rounded-lg cursor-pointer peer-checked:ring-2 peer-checked:ring-blue-500 peer-checked:border-blue-500 transition bg-white dark:bg-slate-700/50 border-stone-300 dark:border-slate-600" },
                                h('h4', { className: "font-bold text-stone-800 dark:text-white" }, planDetails[plan].title),
                                h('p', { className: "text-2xl font-bold text-blue-600 dark:text-blue-400" }, planDetails[plan].price, h('span', { className: "text-sm font-normal text-stone-500 dark:text-stone-400" }, "/mês + IVA")),
                                h('p', { className: "text-sm text-stone-600 dark:text-stone-300 mt-1" }, planDetails[plan].features)
                            )
                        ))
                    )
                ),
                status === 'error' && h(FormStatus, { status: "error", message: "Ocorreu um erro ao enviar o seu registo. Por favor, tente novamente." }),
                h('div', { className: "flex items-center justify-between gap-4 pt-4" },
                    h('button', { type: "button", onClick: onBack, className: "bg-stone-200 dark:bg-slate-700 text-stone-800 dark:text-stone-200 px-6 py-2 rounded-md font-semibold hover:bg-stone-300 dark:hover:bg-slate-600 transition" }, "Voltar"),
                    h('button', { type: "submit", disabled: !isFormValid || status === 'submitting', className: "bg-blue-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-700 transition disabled:bg-blue-400 disabled:cursor-not-allowed" }, status === 'submitting' ? 'A Enviar...' : 'Registar')
                )
            );
        };
    
        const RegistrationSelector = ({ onSelect }) => {
            return h('div', { className: "text-center" },
                h('h2', { className: "text-3xl font-bold mb-2 text-stone-900 dark:text-white" }, "Junte-se à IDEA"),
                h('p', { className: "text-stone-600 dark:text-stone-300 mb-8" }, "Selecione o tipo de conta que pretende criar."),
                h('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                    h('button', { onClick: () => onSelect('company'), className: "p-8 border-2 border-stone-200 dark:border-slate-700 rounded-lg text-left hover:border-blue-500 dark:hover:border-blue-500 hover:bg-stone-50 dark:hover:bg-slate-700/50 transition-all transform hover:scale-105" },
                        h('h3', { className: "text-xl font-bold text-blue-600 dark:text-blue-400" }, "Sou uma Empresa / Profissional"),
                        h('p', { className: "mt-2 text-stone-600 dark:text-stone-300" }, "Quero oferecer os meus serviços, encontrar novos clientes e aumentar o meu negócio.")
                    ),
                    h('button', { onClick: () => onSelect('client'), className: "p-8 border-2 border-stone-200 dark:border-slate-700 rounded-lg text-left hover:border-blue-500 dark:hover:border-blue-500 hover:bg-stone-50 dark:hover:bg-slate-700/50 transition-all transform hover:scale-105" },
                        h('h3', { className: "text-xl font-bold text-blue-600 dark:text-blue-400" }, "Sou um Cliente"),
                        h('p', { className: "mt-2 text-stone-600 dark:text-stone-300" }, "Preciso de encontrar profissionais qualificados para resolver um problema ou para um projeto.")
                    )
                )
            );
        };

        const renderContent = () => {
            switch (view) {
                case 'company': return h(CompanyRegistrationForm, { onBack: () => setView('select') });
                case 'client': return h(ClientRegistrationForm, { onBack: () => setView('select') });
                default: return h(RegistrationSelector, { onSelect: setView });
            }
        };
    
        return h(Modal, { isOpen: isOpen, onClose: handleClose }, renderContent());
      };

      // --- MODAL DE LOGIN ---
      const LoginModal = ({ isOpen, onClose, onLogin }) => {
        const [view, setView] = useState('select');

        const handleClose = () => {
          onClose();
          setTimeout(() => setView('select'), 300);
        };
        
        const ClientLoginForm = ({ onBack }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');

            const handleSimulatedLogin = (e) => {
                e.preventDefault();
                if (email && password) {
                    onLogin({ type: 'client', name: email.split('@')[0] });
                }
            };
            
            return h('form', { onSubmit: handleSimulatedLogin, className: 'space-y-4' },
                h('h2', { className: "text-2xl font-bold text-center text-stone-800 dark:text-white" }, "Login de Cliente"),
                h(FormInput, { name: "email", placeholder: "Email", type: "email", value: email, onChange: (e) => setEmail(e.target.value), required: true }),
                h(FormInput, { name: "password", placeholder: "Palavra-passe", type: "password", value: password, onChange: (e) => setPassword(e.target.value), required: true }),
                h('div', { className: "flex items-center justify-between gap-4 pt-4" },
                    h('button', { type: "button", onClick: onBack, className: "bg-stone-200 dark:bg-slate-700 text-stone-800 dark:text-stone-200 px-6 py-2 rounded-md font-semibold hover:bg-stone-300 dark:hover:bg-slate-600 transition" }, "Voltar"),
                    h('button', { type: "submit", className: "bg-blue-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-700 transition" }, "Entrar")
                )
            );
        };

        const ProviderLoginForm = ({ onBack }) => {
            const [providerId, setProviderId] = useState('');
            const [password, setPassword] = useState('');

            const handleSimulatedLogin = (e) => {
                e.preventDefault();
                if (providerId && password) {
                    onLogin({ type: 'provider', id: providerId, profileComplete: false }); // profileComplete: false for demo
                }
            };

            return h('form', { onSubmit: handleSimulatedLogin, className: 'space-y-4' },
                h('h2', { className: "text-2xl font-bold text-center text-stone-800 dark:text-white" }, "Login de Prestador"),
                h(FormInput, { name: "providerId", placeholder: "Número de Cadastro", value: providerId, onChange: (e) => setProviderId(e.target.value), required: true }),
                h(FormInput, { name: "password", placeholder: "Palavra-passe", type: "password", value: password, onChange: (e) => setPassword(e.target.value), required: true }),
                h('div', { className: "flex items-center justify-between gap-4 pt-4" },
                    h('button', { type: "button", onClick: onBack, className: "bg-stone-200 dark:bg-slate-700 text-stone-800 dark:text-stone-200 px-6 py-2 rounded-md font-semibold hover:bg-stone-300 dark:hover:bg-slate-600 transition" }, "Voltar"),
                    h('button', { type: "submit", className: "bg-blue-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-700 transition" }, "Entrar")
                )
            );
        };

        const LoginSelector = ({ onSelect }) => {
          return h('div', { className: "text-center" },
            h('h2', { className: "text-3xl font-bold mb-2 text-stone-900 dark:text-white" }, "Bem-vindo de Volta"),
            h('p', { className: "text-stone-600 dark:text-stone-300 mb-8" }, "Selecione o tipo de conta para fazer login."),
            h('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
              h('button', { onClick: () => onSelect('provider'), className: "p-8 border-2 border-stone-200 dark:border-slate-700 rounded-lg text-left hover:border-blue-500 dark:hover:border-blue-500 hover:bg-stone-50 dark:hover:bg-slate-700/50 transition-all transform hover:scale-105" },
                h('h3', { className: "text-xl font-bold text-blue-600 dark:text-blue-400" }, "Sou Prestador de Serviço"),
                h('p', { className: "mt-2 text-stone-600 dark:text-stone-300" }, "Aceda à sua área para gerir pedidos e o seu perfil.")
              ),
              h('button', { onClick: () => onSelect('client'), className: "p-8 border-2 border-stone-200 dark:border-slate-700 rounded-lg text-left hover:border-blue-500 dark:hover:border-blue-500 hover:bg-stone-50 dark:hover:bg-slate-700/50 transition-all transform hover:scale-105" },
                h('h3', { className: "text-xl font-bold text-blue-600 dark:text-blue-400" }, "Sou Cliente"),
                h('p', { className: "mt-2 text-stone-600 dark:text-stone-300" }, "Aceda à sua conta para pedir orçamentos e ver o estado dos seus pedidos.")
              )
            )
          );
        };
        
        const renderContent = () => {
            switch (view) {
                case 'provider': return h(ProviderLoginForm, { onBack: () => setView('select') });
                case 'client': return h(ClientLoginForm, { onBack: () => setView('select') });
                default: return h(LoginSelector, { onSelect: setView });
            }
        };

        return h(Modal, { isOpen: isOpen, onClose: handleClose }, renderContent());
      };

      // --- MODAL DE PERFIL DO PRESTADOR ---
      const ProviderProfileModal = ({ isOpen, onClose, onSave }) => {
        const [profile, setProfile] = useState({ service: '', hourlyRate: '', description: '' });

        const handleChange = (e) => {
            const { name, value } = e.target;
            setProfile(prev => ({ ...prev, [name]: value }));
        };

        const handleSave = () => {
            onSave(profile);
            onClose();
        };

        return h(Modal, { isOpen, onClose },
            h('div', { className: 'space-y-6' },
                h('h2', { className: "text-2xl font-bold text-center text-stone-800 dark:text-white" }, "Configure o seu Perfil Público"),
                h('p', { className: "text-center text-stone-600 dark:text-stone-300" }, "Esta informação será visível para os clientes. Por favor, preencha com atenção."),
                h('div', null,
                    h('label', { htmlFor: "service-profile", className: "block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1" }, "Qual é o seu serviço principal?"),
                    h('select', { id: "service-profile", name: "service", value: profile.service, onChange: handleChange, required: true, className: "w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500" },
                        h('option', { value: "" }, "Selecione o seu serviço..."),
                        ...ALL_SERVICES.map(s => h('option', { key: s, value: s }, s))
                    )
                ),
                h('div', null,
                    h('label', { htmlFor: "hourlyRate", className: "block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1" }, "Preço médio por hora (com IVA)"),
                    h('input', { type: 'number', id: 'hourlyRate', name: 'hourlyRate', value: profile.hourlyRate, onChange: handleChange, placeholder: 'Ex: 25', className: "w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500" })
                ),
                h('div', null,
                    h('label', { htmlFor: "description-profile", className: "block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1" }, "Breve descrição sobre o seu trabalho"),
                    h('textarea', { id: "description-profile", name: "description", value: profile.description, onChange: handleChange, rows: 5, className: "w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500", placeholder: "Descreva a sua experiência, especialidades, etc." })
                ),
                h('div', { className: "bg-red-100 dark:bg-red-900/50 border-l-4 border-red-500 text-red-700 dark:text-red-300 p-4 rounded-md" },
                  h('p', { className: "font-bold" }, "Atenção: Regra da Plataforma"),
                  h('p', { className: "text-sm" }, "É estritamente proibido incluir qualquer informação de contacto (número de telefone, email, website, morada) nesta descrição. A violação desta regra resultará no banimento imediato da conta e na perda de qualquer valor de subscrição pago.")
                ),
                h('div', { className: 'flex justify-end pt-4' },
                    h('button', { onClick: handleSave, className: 'bg-blue-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-700 transition' }, 'Guardar Perfil')
                )
            )
        );
      };

      // --- COMPONENTES PRINCIPAIS DA PÁGINA ---
      
      const Header = ({ theme, toggleTheme, onRegisterClick, onLoginClick, onLogout, currentUser }) => {
        const navLinks = [
          { name: 'Quem Somos', href: '#quem-somos' }, { name: 'Serviços', href: '#serviços' }, { name: 'Como Funciona', href: '#como-funciona' }, { name: 'Contactos', href: '#contactos' },
        ];
        return h('header', { className: "sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm shadow-md" },
          h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
            h('div', { className: "flex items-center justify-between h-20" },
              h('div', { className: "flex items-center space-x-4" },
                h('a', { href: "#", className: "text-3xl font-bold text-blue-600 dark:text-blue-500" }, "IDEA"),
                h('p', { className: "hidden md:block text-sm text-stone-500 dark:text-stone-400 mt-1" }, "Serviços de Urgência 24/7")
              ),
              h('nav', { className: "hidden lg:flex items-center space-x-8" },
                navLinks.map(link => h('a', { key: link.name, href: link.href, className: "text-stone-600 dark:text-stone-300 hover:text-blue-600 dark:hover:text-blue-500 transition-colors font-medium" }, link.name))
              ),
              h('div', { className: "flex items-center space-x-4" },
                currentUser ? (
                    h('div', { className: "flex items-center space-x-4" },
                        h('span', { className: 'text-sm font-medium hidden sm:inline' }, `Bem-vindo, ${currentUser.type === 'client' ? currentUser.name : currentUser.id}`),
                        h('button', { onClick: onLogout, className: "bg-stone-200 dark:bg-slate-700 text-stone-800 dark:text-stone-200 px-4 py-2 rounded-md font-semibold hover:bg-stone-300 dark:hover:bg-slate-600 transition-colors text-sm" }, "Logout")
                    )
                ) : (
                    h(React.Fragment, null,
                        h('button', { onClick: onLoginClick, className: "hidden sm:inline-block text-stone-600 dark:text-stone-300 hover:text-blue-600 dark:hover:text-blue-500 transition-colors font-semibold text-sm" }, "Login"),
                        h('button', { onClick: onRegisterClick, className: "hidden sm:inline-block bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700 transition-colors text-sm" }, "Registar")
                    )
                ),
                h('button', { onClick: toggleTheme, className: "p-2 rounded-full text-stone-500 dark:text-stone-400 hover:bg-stone-200 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-slate-900", 'aria-label': "Toggle theme" },
                  theme === 'light' ? h(MoonIcon, { className: "h-6 w-6" }) : h(SunIcon, { className: "h-6 w-6" })
                )
              )
            )
          )
        );
      };

      const Hero = () => {
        const features = [
          { text: 'Resposta em minutos', icon: h(BoltIcon, { className: "w-5 h-5 text-blue-500" }) },
          { text: 'Profissionais verificados', icon: h(CheckBadgeIcon, { className: "w-5 h-5 text-blue-500" }) },
          { text: 'Pagamento após serviço', icon: h(CreditCardIcon, { className: "w-5 h-5 text-blue-500" }) },
          { text: 'Disponível em todo o país', icon: h(GlobeAltIcon, { className: "w-5 h-5 text-blue-500" }) },
        ];
        return h('section', { className: "py-20 lg:py-32 bg-stone-50 dark:bg-slate-800/50 relative overflow-hidden" },
            h('div', { className: "absolute inset-0 bg-cover bg-center bg-[url('https://picsum.photos/seed/lisbon/1920/1080')] opacity-10 dark:opacity-5" }),
            h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10" },
                h('h1', { className: "text-4xl md:text-5xl lg:text-6xl font-bold text-stone-900 dark:text-white leading-tight mb-4" },
                    "A solução para os seus problemas, ", h('span', { className: "text-blue-600 dark:text-blue-500" }, "agora"), "."
                ),
                h('p', { className: "max-w-3xl mx-auto text-lg text-stone-600 dark:text-stone-300 mb-8" },
                    "Encontre profissionais qualificados para qualquer serviço, a qualquer hora. Desde uma reparação urgente a um projeto planeado."
                ),
                h('div', { className: "max-w-4xl mx-auto bg-white dark:bg-slate-800 p-4 rounded-lg shadow-lg flex flex-col md:flex-row items-center gap-4" },
                    h('div', { className: "relative flex-grow w-full" },
                        h(MagnifyingGlassIcon, { className: "w-5 h-5 text-stone-400 absolute left-3 top-1/2 -translate-y-1/2" }),
                        h('input', { type: "text", placeholder: "Qual serviço precisa? Ex: 'eletricista'", className: "w-full pl-10 pr-4 py-3 border-2 border-transparent focus:border-blue-500 bg-stone-100 dark:bg-slate-700 rounded-md focus:outline-none transition" })
                    ),
                    h('div', { className: "flex items-center gap-2 w-full md:w-auto" },
                        h('a', { href: "#pedir-orcamento", className: "bg-blue-600 text-white font-semibold px-8 py-3 rounded-md hover:bg-blue-700 transition-transform hover:scale-105 w-full md:w-auto" }, "Procurar"),
                        h('a', { href: "#pedir-orcamento", className: "bg-stone-200 dark:bg-slate-700 font-semibold px-8 py-3 rounded-md hover:bg-stone-300 dark:hover:bg-slate-600 transition-transform hover:scale-105 w-full md:w-auto" }, "Orçamento Grátis")
                    )
                ),
                h('div', { className: "mt-8 flex flex-wrap justify-center items-center gap-x-6 gap-y-2" },
                    features.map((feature, index) => h('div', { key: index, className: "flex items-center gap-2 text-sm text-stone-600 dark:text-stone-400" },
                        feature.icon,
                        h('span', null, feature.text)
                    ))
                )
            )
        );
      };

      const ServiceCategories = ({ onServiceSelect }) => {
          const [isExpanded, setIsExpanded] = useState(false);
          const visibleCategories = isExpanded ? SERVICE_CATEGORIES : SERVICE_CATEGORIES.slice(0, 12);
          
          const handleSelect = (serviceName) => {
            onServiceSelect(serviceName);
            const quoteSection = document.getElementById('pedir-orcamento');
            if (quoteSection) {
              quoteSection.scrollIntoView({ behavior: 'smooth' });
            }
          };

          return h('section', { id: "serviços", className: "py-16 sm:py-24" },
              h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
                  h('div', { className: "text-center mb-12" },
                      h('h2', { className: "text-3xl md:text-4xl font-bold text-stone-900 dark:text-white" }, "Tudo o que precisa, num só lugar"),
                      h('p', { className: "mt-4 text-lg text-stone-600 dark:text-stone-300 max-w-2xl mx-auto" }, "Explore a nossa vasta gama de serviços profissionais disponíveis 24/7.")
                  ),
                  h('div', { className: "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 sm:gap-6" },
                      visibleCategories.map((category) => {
                        const IconComponent = category.icon;
                        return h('button', { 
                          key: category.name, 
                          onClick: () => handleSelect(category.name),
                          className: "group flex flex-col items-center justify-center p-6 bg-white dark:bg-slate-800 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-2 transition-all duration-300 cursor-pointer text-center w-full" 
                        },
                            h('div', { className: "text-blue-600 dark:text-blue-500 mb-4 transition-transform duration-300 group-hover:scale-110" }, h(IconComponent, { className: "w-8 h-8" })),
                            h('h3', { className: "text-base font-semibold text-stone-800 dark:text-stone-200" }, category.name)
                        )
                      })
                  ),
                  h('div', { className: "text-center mt-12" },
                    h('button', { onClick: () => setIsExpanded(!isExpanded), className: "bg-stone-200 dark:bg-slate-700 text-stone-800 dark:text-stone-200 px-6 py-3 rounded-md font-semibold hover:bg-stone-300 dark:hover:bg-slate-600 transition-colors flex items-center gap-2 mx-auto" },
                        isExpanded ? 'Mostrar menos serviços' : 'Mostrar mais serviços',
                        isExpanded ? h(ChevronUpIcon, { className: "w-5 h-5" }) : h(ChevronDownIcon, { className: "w-5 h-5" })
                    )
                  )
              )
          );
      };

      const HowItWorks = () => {
          const NumberStep = ({ number, title, children }) => h('div', { className: "flex" },
              h('div', { className: "flex flex-col items-center mr-4" },
                  h('div', null, h('div', { className: "flex items-center justify-center w-10 h-10 border rounded-full bg-blue-600 text-white font-bold" }, number)),
                  h('div', { className: "w-px h-full bg-stone-300 dark:bg-slate-600" })
              ),
              h('div', { className: "pb-8" },
                  h('p', { className: "mb-2 text-xl font-bold text-stone-900 dark:text-white" }, title),
                  h('p', { className: "text-stone-600 dark:text-stone-300" }, children)
              )
          );
          return h('section', { id: "como-funciona", className: "py-16 sm:py-24 bg-stone-100 dark:bg-slate-800/50" },
              h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
                  h('div', { className: "text-center mb-12" },
                      h('h2', { className: "text-3xl md:text-4xl font-bold text-stone-900 dark:text-white" }, "Como Funciona? Simples e Transparente."),
                      h('p', { className: "mt-4 text-lg text-stone-600 dark:text-stone-300 max-w-2xl mx-auto" }, "Siga estes 3 passos para resolver o seu problema de forma rápida e eficiente.")
                  ),
                  h('div', { className: "grid gap-8 md:grid-cols-2 lg:grid-cols-3" },
                      h('div', { className: "lg:col-span-2" },
                          h('h3', { className: "text-2xl font-semibold mb-6 text-stone-800 dark:text-stone-100" }, "Para Clientes"),
                          h(NumberStep, { number: "1", title: "Descreva o Serviço" }, "Preencha o nosso formulário detalhando o que precisa. O pedido é anónimo e será enviado aos profissionais qualificados na sua área."),
                          h(NumberStep, { number: "2", title: "Receba Vários Orçamentos" }, "Os profissionais interessados enviam as suas propostas. O que fizer o preço mais competitivo e tiver a melhor avaliação, fica com o trabalho."),
                          h('div', { className: "flex" },
                              h('div', { className: "flex flex-col items-center mr-4" }, h('div', null, h('div', { className: "flex items-center justify-center w-10 h-10 border rounded-full bg-blue-600 text-white font-bold" }, "3"))),
                              h('div', { className: "pb-8" },
                                  h('p', { className: "mb-2 text-xl font-bold text-stone-900 dark:text-white" }, "Escolha e Pague com Segurança"),
                                  h('p', { className: "text-stone-600 dark:text-stone-300" }, "Aceite o orçamento, combine os detalhes e, após a conclusão do serviço, pague através da nossa plataforma segura. Nós garantimos que o prestador só recebe após a sua confirmação.")
                              )
                          )
                      ),
                      h('div', { className: "bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg" },
                          h('h3', { className: "text-2xl font-semibold mb-6 text-stone-800 dark:text-stone-100" }, "Para Prestadores"),
                          h('div', { className: "space-y-6" },
                              h('div', null,
                                  h('h4', { className: "font-bold text-lg text-stone-900 dark:text-white" }, "Registo e Mensalidade"),
                                  h('p', { className: "text-stone-600 dark:text-stone-300 mt-1" }, "Os primeiros ", h('span', { className: "font-semibold text-blue-600 dark:text-blue-400" }, "6 meses são grátis"), ". Após o período de teste, a subscrição é de apenas ", h('span', { className: "font-semibold" }, "10€/mês (+IVA)"), " para acesso ilimitado a pedidos de clientes.")
                              ),
                              h('div', null,
                                  h('h4', { className: "font-bold text-lg text-stone-900 dark:text-white" }, "Comissões de Serviço"),
                                  h('p', { className: "text-stone-600 dark:text-stone-300 mt-1" }, "Cobramos uma comissão de ", h('span', { className: "font-semibold" }, "10% a 15% (+IVA)"), " apenas sobre os trabalhos que concluir com sucesso através da plataforma. Sem trabalho, sem custos.")
                              ),
                              h('div', null,
                                  h('h4', { className: "font-bold text-lg text-stone-900 dark:text-white" }, "Pagamento Garantido"),
                                  h('p', { className: "text-stone-600 dark:text-stone-300 mt-1" }, "O cliente paga à plataforma no momento da adjudicação. O valor é libertado para si assim que o serviço é marcado como concluído pelo cliente, garantindo total segurança.")
                              )
                          )
                      )
                  )
              )
          );
      };

      const PriceSimulator = () => {
        const [service, setService] = useState('');
        const [estimate, setEstimate] = useState(null);

        const handleSimulate = (e) => {
            e.preventDefault();
            if (service && QUICK_PRICE_ESTIMATES[service]) {
                setEstimate(QUICK_PRICE_ESTIMATES[service]);
            } else {
                setEstimate(service ? { min: 40, max: 300 } : null);
            }
        };

        return h('section', { className: "bg-white dark:bg-slate-800 py-16 sm:py-24" },
            h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl" },
                h('div', { className: "text-center" },
                    h('h2', { className: "text-3xl md:text-4xl font-bold text-stone-900 dark:text-white" }, "Tenha uma Ideia do Custo"),
                    h('p', { className: "mt-4 text-lg text-stone-600 dark:text-stone-300 mx-auto" }, "Use o nosso simulador rápido para obter uma estimativa de preço instantânea para o seu serviço.")
                ),
                h('form', { onSubmit: handleSimulate, className: "mt-8 p-6 bg-stone-100 dark:bg-slate-800/50 rounded-lg shadow-md flex flex-col md:flex-row items-center gap-4" },
                    h('div', { className: "w-full md:flex-grow" },
                        h('label', { htmlFor: "quick-service", className: "sr-only" }, "Tipo de Serviço"),
                        h('select', { id: "quick-service", value: service, onChange: (e) => { setService(e.target.value); setEstimate(null); }, required: true, className: "w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500" },
                            h('option', { value: "" }, "Selecione um serviço para estimar..."),
                            ALL_SERVICES.map(s => h('option', { key: s, value: s }, s))
                        )
                    ),
                    h('button', { type: "submit", className: "w-full md:w-auto bg-slate-600 text-white font-bold py-3 px-6 rounded-md hover:bg-slate-700 transition-colors" }, "Simular Preço")
                ),
                estimate && h('div', { className: "mt-8 text-center p-8 bg-blue-50 dark:bg-blue-900/50 rounded-lg animate-fade-in" },
                    h('p', { className: "text-lg text-blue-800 dark:text-blue-200" }, "Estimativa Rápida de Custo"),
                    h('p', { className: "text-4xl font-bold text-blue-600 dark:text-blue-400 my-2" }, `€${estimate.min} - €${estimate.max}`),
                    h('p', { className: "text-sm text-stone-500 dark:text-stone-400 mb-6" }, "*Este valor é uma estimativa base. Para um orçamento exato, continue para o próximo passo."),
                    h('a', { href: "#pedir-orcamento", className: "inline-block bg-blue-600 text-white font-bold py-3 px-8 rounded-md hover:bg-blue-700 transition-transform hover:scale-105" }, "Obter Orçamento Detalhado")
                )
            )
        );
    };

      const ProviderListings = () => {
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedService, setSelectedService] = useState('');
          const [minRating, setMinRating] = useState(0);

          const topServices = useMemo(() => {
              const serviceCounts = SERVICE_PROVIDERS.reduce((acc, provider) => {
                  acc[provider.service] = (acc[provider.service] || 0) + 1;
                  return acc;
              }, {});
              return Object.entries(serviceCounts).sort(([, a], [, b]) => b - a).slice(0, 6).map(([service]) => service);
          }, []);

          const availableServices = useMemo(() => Array.from(new Set(SERVICE_PROVIDERS.map(p => p.service))).sort(), []);

          const filteredProviders = useMemo(() => {
              return SERVICE_PROVIDERS
                  .filter(p => !selectedService || p.service === selectedService)
                  .filter(p => minRating <= 0 || p.rating >= minRating)
                  .filter(p => {
                      if (!searchTerm) return true;
                      const term = searchTerm.toLowerCase();
                      return p.anonymousName.toLowerCase().includes(term) || p.service.toLowerCase().includes(term) || p.tagline.toLowerCase().includes(term);
                  });
          }, [searchTerm, selectedService, minRating]);

          const handleContact = (providerName) => {
              alert(`A sua mensagem foi enviada para ${providerName}. Será contactado em breve para finalizar os detalhes.\n\n(Esta é uma demonstração. Nenhuma mensagem real foi enviada.)`);
          };
          
          return h('section', { className: "py-16 sm:py-24" },
              h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
                  h('div', { className: "text-center mb-12" },
                      h('h2', { className: "text-3xl md:text-4xl font-bold text-stone-900 dark:text-white" }, "Encontre o Profissional Ideal"),
                      h('p', { className: "mt-4 text-lg text-stone-600 dark:text-stone-300 max-w-2xl mx-auto" }, "A nossa rede de profissionais é verificada e avaliada para garantir a sua satisfação.")
                  ),
                  h('div', { className: "mb-12 bg-white dark:bg-slate-800/50 p-6 rounded-lg shadow-md space-y-6" },
                      h('div', null,
                          h('label', { className: "block text-sm font-medium text-stone-700 dark:text-stone-300 mb-2" }, "Serviços Populares"),
                          h('div', { className: "flex flex-wrap gap-2" },
                              h('button', { onClick: () => setSelectedService(''), className: `px-4 py-2 text-sm font-semibold rounded-full transition-colors ${selectedService === '' ? 'bg-blue-600 text-white shadow' : 'bg-stone-200 dark:bg-slate-700 text-stone-800 dark:text-stone-200 hover:bg-stone-300 dark:hover:bg-slate-600'}` }, "Todos"),
                              ...topServices.map(service => h('button', { key: service, onClick: () => setSelectedService(service), className: `px-4 py-2 text-sm font-semibold rounded-full transition-colors ${selectedService === service ? 'bg-blue-600 text-white shadow' : 'bg-stone-200 dark:bg-slate-700 text-stone-800 dark:text-stone-200 hover:bg-stone-300 dark:hover:bg-slate-600'}` }, service))
                          )
                      ),
                      h('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                          h('div', null,
                              h('label', { htmlFor: "search", className: "block text-sm font-medium text-stone-700 dark:text-stone-300" }, "Pesquisar por Palavra-Chave"),
                              h('input', { type: "text", id: "search", value: searchTerm, onChange: e => setSearchTerm(e.target.value), placeholder: "Ex: 'urgente', 'reparação'...", className: "mt-1 w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500" })
                          ),
                          h('div', null,
                              h('label', { htmlFor: "service-filter", className: "block text-sm font-medium text-stone-700 dark:text-stone-300" }, "Ou Selecionar Outro Serviço"),
                              h('select', { id: "service-filter", value: selectedService, onChange: e => setSelectedService(e.target.value), className: "mt-1 w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500" },
                                  h('option', { value: "" }, "Todos os Serviços"),
                                  ...availableServices.map(service => h('option', { key: service, value: service }, service))
                              )
                          ),
                          h('div', null,
                              h('label', { htmlFor: "rating-filter", className: "block text-sm font-medium text-stone-700 dark:text-stone-300" }, "Avaliação Mínima"),
                              h('select', { id: "rating-filter", value: minRating, onChange: e => setMinRating(Number(e.target.value)), className: "mt-1 w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500" },
                                  h('option', { value: "0" }, "Todas"), h('option', { value: "4.5" }, "4.5+ Estrelas"), h('option', { value: "4" }, "4+ Estrelas"), h('option', { value: "3" }, "3+ Estrelas")
                              )
                          )
                      )
                  ),
                  h('div', { className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8" },
                      filteredProviders.length > 0 ?
                          filteredProviders.map(provider => h('div', { key: provider.id, className: "bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6 flex flex-col text-center items-center transform hover:-translate-y-2 transition-transform duration-300" },
                              h('img', { src: provider.avatar, alt: `Avatar de ${provider.anonymousName}`, className: "w-24 h-24 rounded-full mb-4 border-4 border-stone-200 dark:border-slate-700 object-cover" }),
                              h('h3', { className: "font-bold text-lg text-stone-800 dark:text-white" }, provider.anonymousName),
                              h('p', { className: "text-sm text-blue-600 dark:text-blue-400 font-semibold mb-2" }, provider.service),
                              h('div', { className: "flex items-center space-x-1 mb-3" },
                                  h(StarIcon, { className: "w-5 h-5 text-yellow-400" }),
                                  h('span', { className: "font-bold text-stone-700 dark:text-stone-200" }, provider.rating.toFixed(1)),
                                  h('span', { className: "text-sm text-stone-500 dark:text-stone-400" }, `(${provider.jobsCompleted} serviços)`)
                              ),
                              h('p', { className: "text-stone-600 dark:text-stone-300 text-sm italic mb-4 flex-grow" }, `"${provider.tagline}"`),
                              h('div', { className: "w-full flex flex-col space-y-2" },
                                  h('a', { href: "#pedir-orcamento", className: "w-full bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700 transition-colors text-sm" }, "Pedir Orçamento"),
                                  h('button', { onClick: () => handleContact(provider.anonymousName), className: "w-full bg-stone-200 dark:bg-slate-700 text-stone-800 dark:text-stone-200 px-4 py-2 rounded-md font-semibold hover:bg-stone-300 dark:hover:bg-slate-600 transition-colors text-sm" }, "Contactar")
                              )
                          ))
                          : h('div', { className: "col-span-full text-center py-12" },
                              h('h3', { className: "text-xl font-semibold text-stone-700 dark:text-stone-300" }, "Nenhum prestador encontrado"),
                              h('p', { className: "text-stone-500 dark:text-stone-400 mt-2" }, "Tente ajustar os seus filtros de pesquisa.")
                          )
                  )
              )
          );
      };

      const QuoteRequest = ({ preselectedService, onFormInteracted, currentUser, onLoginPrompt }) => {
          const [formData, setFormData] = useState({ service: '', urgency: 'normal', description: '', location: '' });
          const [estimate, setEstimate] = useState(null);
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState(null);
          const [isSubmitted, setIsSubmitted] = useState(false);
          
          useEffect(() => {
            if (preselectedService) {
              setFormData(prev => ({ ...prev, service: preselectedService }));
              onFormInteracted();
            }
          }, [preselectedService]);

          const handleChange = (e) => {
              const { name, value } = e.target;
              setFormData(prev => ({ ...prev, [name]: value }));
          };

          const handleFinalSubmit = () => {
              console.log("Final submission data:", formData);
              setIsSubmitted(true);
          };

          const handleSubmit = async (e) => {
              e.preventDefault();

              if (!currentUser) {
                onLoginPrompt();
                return;
              }

              setLoading(true);
              setError(null);
              setEstimate(null);
              setIsSubmitted(false);

              if (!API_KEY || API_KEY === "SUA_CHAVE_API_AQUI") {
                  setError("Chave de API não configurada. A funcionalidade do simulador está desativada.");
                  setLoading(false);
                  return;
              }

              try {
                  const result = await getAiEstimate(formData);
                  setEstimate(result);
              } catch (err) {
                  setError(err.message || "Não foi possível obter uma estimativa. Por favor, tente novamente mais tarde.");
              } finally {
                  setLoading(false);
              }
          };
          
          const getButtonText = () => {
            if (loading) return h(Spinner);
            if (!currentUser) return 'Fazer Login para Obter Estimativa';
            return 'Obter Estimativa Grátis';
          };

          if (isSubmitted) {
              return h('section', { id: "pedir-orcamento", className: "bg-stone-100 dark:bg-slate-800 py-16 sm:py-24" },
                  h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8 text-center" },
                      h('h2', { className: "text-3xl md:text-4xl font-bold text-stone-900 dark:text-white mb-4" }, "Pedido Enviado com Sucesso!"),
                      h('p', { className: "text-lg text-stone-600 dark:text-stone-300 max-w-2xl mx-auto" }, "O seu pedido para ", h('span', { className: "font-semibold text-blue-600" }, formData.service), " foi enviado para os profissionais na sua área. Irá começar a receber orçamentos em breve na sua área de cliente.")
                  )
              );
          }

          return h('section', { id: "pedir-orcamento", className: "bg-stone-100 dark:bg-slate-800 py-16 sm:py-24" },
              h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
                  h('div', { className: "text-center mb-12" },
                      h('h2', { className: "text-3xl md:text-4xl font-bold text-stone-900 dark:text-white" }, "Peça um Orçamento Grátis"),
                      h('p', { className: "mt-4 text-lg text-stone-600 dark:text-stone-300 max-w-2xl mx-auto" }, "Descreva o que precisa e receba uma estimativa de custos instantânea. Depois, envie o seu pedido aos nossos profissionais para receber propostas competitivas.")
                  ),
                  h('div', { className: "max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-start" },
                      h('form', { onSubmit: handleSubmit, className: "space-y-6 bg-stone-50 dark:bg-slate-800/50 p-8 rounded-lg" },
                          h('div', null,
                              h('label', { htmlFor: "service", className: "block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1" }, "Tipo de Serviço"),
                              h('select', { id: "service", name: "service", value: formData.service, onChange: handleChange, required: true, className: "w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500" }, h('option', { value: "" }, "Selecione um serviço"), ...ALL_SERVICES.map(s => h('option', { key: s, value: s }, s)))
                          ),
                          h('div', null,
                              h('label', { htmlFor: "urgency", className: "block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1" }, "Urgência"),
                              h('select', { id: "urgency", name: "urgency", value: formData.urgency, onChange: handleChange, required: true, className: "w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500" }, h('option', { value: "normal" }, "Agendamento Normal"), h('option', { value: "hoje" }, "Hoje"), h('option', { value: "urgente" }, "Urgente (Próximas horas)"))
                          ),
                          h('div', null,
                              h('label', { htmlFor: "location", className: "block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1" }, "Localização (Cidade/Código Postal)"),
                              h('input', { type: "text", id: "location", name: "location", value: formData.location, onChange: handleChange, required: true, className: "w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500" })
                          ),
                          h('div', null,
                              h('label', { htmlFor: "description", className: "block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1" }, "Descrição Detalhada"),
                              h('textarea', { id: "description", name: "description", value: formData.description, onChange: handleChange, required: true, rows: 5, className: "w-full p-3 border border-stone-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 focus:ring-blue-500 focus:border-blue-500", placeholder: "Ex: Torneira da cozinha a pingar constantemente. Preciso de reparação ou substituição." })
                          ),
                          h('div', null, h('button', { type: "submit", disabled: loading, className: "w-full bg-slate-600 text-white font-bold py-3 px-4 rounded-md hover:bg-slate-700 disabled:bg-stone-400 disabled:cursor-not-allowed transition-colors" }, getButtonText()))
                      ),
                      h('div', { className: "bg-stone-50 dark:bg-slate-900/50 p-8 rounded-lg h-full flex flex-col" },
                          h('h3', { className: "text-2xl font-bold mb-4 text-stone-900 dark:text-white" }, "Resultado"),
                          h('div', { className: "flex-grow" },
                              loading && h('p', { className: "text-center text-stone-500 dark:text-stone-400" }, "A calcular... Por favor, aguarde."),
                              error && h('div', { className: "bg-red-100 dark:bg-red-900/50 border-l-4 border-red-500 text-red-700 dark:text-red-300 p-4 rounded-md" }, h('p', { className: "font-bold" }, "Erro"), h('p', null, error)),
                              estimate && h('div', { className: "space-y-4 animate-fade-in" },
                                  h('div', { className: "bg-blue-50 dark:bg-blue-900/50 text-center p-6 rounded-lg" },
                                      h('p', { className: "text-sm text-blue-800 dark:text-blue-200" }, "Preço Estimado por IA"),
                                      h('p', { className: "text-3xl sm:text-4xl font-bold text-blue-600 dark:text-blue-400" }, `${estimate.estimated_cost_min.toFixed(2)} - ${estimate.estimated_cost_max.toFixed(2)} ${estimate.currency}`)
                                  ),
                                  h('div', null,
                                      h('h4', { className: "font-semibold mb-2 text-stone-800 dark:text-stone-100" }, "Desagregação de Custos:"),
                                      h('ul', { className: "list-disc list-inside space-y-1 text-stone-600 dark:text-stone-300" }, estimate.breakdown.map((item, index) => h('li', { key: index }, h('strong', null, `${item.item}: `), item.cost)))
                                  ),
                                  h('div', null,
                                      h('h4', { className: "font-semibold mb-2 text-stone-800 dark:text-stone-100" }, "Notas da IA:"),
                                      h('p', { className: "text-sm text-stone-500 dark:text-stone-400 italic" }, estimate.notes)
                                  )
                              ),
                              !loading && !estimate && !error && h('div', { className: "text-center text-stone-500 dark:text-stone-400 h-full flex flex-col items-center justify-center" }, h('p', null, "Preencha o formulário para receber uma estimativa de preço instantânea."), h('p', { className: "text-xs mt-2" }, "*Esta é uma estimativa e não um orçamento final."))
                          ),
                          estimate && h('div', { className: "mt-6" }, h('button', { onClick: handleFinalSubmit, className: "w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-md hover:bg-blue-700 transition-colors" }, "2. Enviar Pedido e Receber Orçamentos"))
                      )
                  )
              )
          );
      };

      const Testimonials = () => {
          return h('section', { className: "bg-stone-100 dark:bg-slate-800/50 py-16 sm:py-24" },
              h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
                  h('div', { className: "text-center mb-12" },
                      h('h2', { className: "text-3xl md:text-4xl font-bold text-stone-900 dark:text-white" }, "Avaliações de Clientes Satisfeitos"),
                      h('p', { className: "mt-4 text-lg text-stone-600 dark:text-stone-300 max-w-2xl mx-auto" }, "Veja o que os nossos clientes dizem sobre os profissionais da nossa plataforma.")
                  ),
                  h('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-8" },
                      TESTIMONIALS.map(review => h('div', { key: review.id, className: "bg-white dark:bg-slate-800 p-8 rounded-lg shadow-lg" },
                          h('div', { className: "flex items-start" },
                              h('img', { src: review.avatar, alt: "Avatar do cliente", className: "w-16 h-16 rounded-full mr-6 object-cover" }),
                              h('div', { className: "flex-1" },
                                  h('div', { className: "flex items-center justify-between mb-2 flex-wrap" },
                                      h('div', null,
                                          h('h4', { className: "font-bold text-lg text-stone-800 dark:text-white" }, review.client),
                                          h('p', { className: "text-sm text-stone-500 dark:text-stone-400" }, review.service)
                                      ),
                                      h('div', { className: "flex items-center space-x-1" },
                                          [...Array(5)].map((_, i) => h(StarIcon, { key: i, className: `w-5 h-5 ${i < Math.round(review.rating) ? 'text-yellow-400' : 'text-stone-300 dark:text-slate-600'}` })),
                                          h('span', { className: "font-bold text-stone-700 dark:text-stone-200 ml-2" }, review.rating.toFixed(1))
                                      )
                                  ),
                                  h('blockquote', { className: "text-stone-600 dark:text-stone-300 italic border-l-4 border-blue-200 dark:border-blue-800 pl-4 py-2" }, `"${review.comment}"`)
                              )
                          )
                      ))
                  )
              )
          );
      };

      const AdBanner = () => {
          return h('section', { className: "py-12 bg-stone-100 dark:bg-slate-800/50" },
              h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
                  h('div', { className: "bg-gradient-to-r from-blue-600 to-indigo-700 dark:from-blue-700 dark:to-indigo-800 rounded-lg shadow-xl p-8 md:p-12 flex flex-col md:flex-row items-center justify-between gap-8" },
                      h('div', { className: "text-white text-center md:text-left" },
                          h('h2', { className: "text-3xl font-bold" }, "É um Profissional ou Empresa?"),
                          h('p', { className: "mt-2 text-lg opacity-90 max-w-2xl" }, "Aumente a sua visibilidade e alcance milhares de novos clientes. Anuncie na nossa plataforma.")
                      ),
                      h('div', { className: "flex-shrink-0" }, h('button', { className: "bg-white text-blue-700 font-bold py-3 px-8 rounded-full hover:bg-slate-100 transition-transform hover:scale-105 shadow-md" }, "Publicitar Agora"))
                  )
              )
          );
      };

      const MapSection = () => {
        const mapContainerRef = useRef(null);
        const mapInstanceRef = useRef(null);
        const blinkingMarkersRef = useRef([]);
        const userLocationMarkerRef = useRef(null);
    
        const [isLocating, setIsLocating] = useState(false);
        const [userLocationFound, setUserLocationFound] = useState(false);
    
        const MAJOR_CITIES = [
            { name: 'Lisboa', lat: 38.7223, lng: -9.1393, zoom: 12 },
            { name: 'Porto', lat: 41.1579, lng: -8.6291, zoom: 12 },
            { name: 'Viseu', lat: 40.6575, lng: -7.9138, zoom: 13 },
            { name: 'Beja', lat: 38.0151, lng: -7.8633, zoom: 13 },
            { name: 'Braga', lat: 41.5454, lng: -8.4265, zoom: 12 },
            { name: 'Faro', lat: 37.0194, lng: -7.9304, zoom: 13 }
        ];
    
        const initializeMap = (container) => {
            if (!container || !window.L) return null;
    
            const map = L.map(container, {
                zoomControl: true,
                scrollWheelZoom: false,
            }).setView([39.5, -8.0], 7);
    
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 20
            }).addTo(map);
    
            setTimeout(() => map.invalidateSize(), 100);
            return map;
        };
    
        const createInteractivePopup = (data, map) => {
            const popupNode = document.createElement('div');
            const PopupContent = () => {
                const handleClick = (e) => {
                    e.preventDefault();
                    document.getElementById('pedir-orcamento')?.scrollIntoView({ behavior: 'smooth' });
                    map.closePopup();
                };
                
                useEffect(() => {
                    const selector = popupNode.querySelector('.typewriter-effect');
                    if (selector) {
                       selector.classList.remove('animate-typing');
                       void selector.offsetWidth; 
                       selector.classList.add('animate-typing');
                    }
                }, []);


                return h('div', { className: 'map-popup-content' },
                    h('div', { className: 'typewriter-container' },
                        h('strong', { className: 'service-name typewriter-effect' }, data.service)
                    ),
                    h('span', { className: 'location-name' }, data.city),
                    h('button', { onClick: handleClick, className: 'popup-button' }, 'Pedir Orçamento')
                );
            };
            
            const root = ReactDOM.createRoot(popupNode);
            
            map.on('popupopen', (e) => {
              if (e.popup.getContent() === popupNode) {
                root.render(h(PopupContent));
              }
            });

            return popupNode;
        };
    
        const addBlinkingMarkers = useCallback((map, markersRef) => {
            if (markersRef.current.length > 0) {
                markersRef.current.forEach(m => map.removeLayer(m));
                markersRef.current = [];
            }
    
            const locations = [...MAP_MARKER_DATA].sort(() => 0.5 - Math.random()).slice(0, 3);
    
            locations.forEach(data => {
                const blinkingIcon = L.divIcon({
                    className: 'blinking-marker',
                    html: '',
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });
    
                const newMarker = L.marker([data.lat, data.lng], { icon: blinkingIcon }).addTo(map);
                const popupContent = createInteractivePopup(data, map);
                newMarker.bindPopup(popupContent);
    
                markersRef.current.push(newMarker);
            });
        }, []);
    
        const handleCityClick = (city) => {
            if (mapInstanceRef.current) {
                mapInstanceRef.current.flyTo([city.lat, city.lng], city.zoom || 12);
            }
        };
    
        const handleLocateUser = () => {
            const map = mapInstanceRef.current;
            if (!map || !navigator.geolocation) return;
    
            setIsLocating(true);
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    map.flyTo([latitude, longitude], 13);
    
                    if (userLocationMarkerRef.current) {
                        map.removeLayer(userLocationMarkerRef.current);
                    }
    
                    const newMarker = L.marker([latitude, longitude]).addTo(map)
                        .bindPopup('A sua localização atual.')
                        .openPopup();
                        
                    userLocationMarkerRef.current = newMarker;
                    setIsLocating(false);
                    setUserLocationFound(true);
                },
                (error) => {
                    alert("Não foi possível obter a sua localização. Verifique as permissões do seu navegador.");
                    setIsLocating(false);
                }
            );
        };
    
        useEffect(() => {
            if (mapContainerRef.current && !mapInstanceRef.current) {
                const map = initializeMap(mapContainerRef.current);
                mapInstanceRef.current = map;
                if (map) {
                    addBlinkingMarkers(map, blinkingMarkersRef);
                    const interval = setInterval(() => addBlinkingMarkers(map, blinkingMarkersRef), 5000);
                    return () => clearInterval(interval);
                }
            }
        }, [addBlinkingMarkers]);
    
        return h('section', { className: "py-16 sm:py-24" },
            h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
                h('div', { className: "text-center mb-12" },
                    h('h2', { className: "text-3xl md:text-4xl font-bold text-stone-900 dark:text-white" }, "Presentes em Todo o Território Nacional"),
                    h('p', { className: "mt-4 text-lg text-stone-600 dark:text-stone-300 max-w-2xl mx-auto" }, "Encontre profissionais perto de si, de norte a sul do país e ilhas.")
                ),
                h('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-8 items-start' },
                    h('div', { className: 'md:col-span-1 space-y-4' },
                        !userLocationFound && h('button', { 
                            onClick: handleLocateUser, 
                            disabled: isLocating, 
                            className: 'w-full text-left p-4 rounded-lg bg-blue-600 text-white shadow-md hover:bg-blue-700 transition-all flex items-center justify-center gap-2 disabled:bg-blue-400 font-semibold' 
                        },
                           h(LocationMarkerIcon, { className: "w-5 h-5" }),
                           isLocating ? 'A localizar...' : 'Usar a minha localização'
                        ),
                        h('hr', { className: "border-stone-200 dark:border-slate-700" }),
                        ...MAJOR_CITIES.map(city => 
                            h('button', {
                                key: city.name,
                                onClick: () => handleCityClick(city),
                                className: 'w-full text-left p-4 rounded-lg bg-white dark:bg-slate-800 shadow-md hover:bg-blue-50 dark:hover:bg-slate-700/50 hover:shadow-lg transition-all transform hover:scale-105'
                            },
                                h('h3', { className: 'font-bold text-lg text-stone-800 dark:text-white' }, city.name)
                            )
                        )
                    ),
                    h('div', { className: 'md:col-span-2' },
                        h('div', { 
                            ref: mapContainerRef, 
                            className: "h-[500px] w-full rounded-lg overflow-hidden shadow-2xl bg-stone-200 dark:bg-slate-700"
                        })
                    )
                )
            )
        );
    };

      const AboutUs = () => {
          return h('section', { id: "quem-somos", className: "bg-white dark:bg-slate-800 py-16 sm:py-24" },
              h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
                  h('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-12 items-center" },
                      h('div', null,
                          h('h2', { className: "text-3xl md:text-4xl font-bold text-stone-900 dark:text-white mb-4" }, "Quem Somos"),
                          h('p', { className: "text-lg text-stone-600 dark:text-stone-300 mb-4" }, "A ", h('span', { className: "font-bold text-blue-600 dark:text-blue-500" }, "IDEA"), " nasceu da necessidade de simplificar a busca por serviços de confiança em Portugal. A nossa missão é conectar clientes a profissionais qualificados de forma rápida, transparente e segura, 24 horas por dia, 7 dias por semana."),
                          h('p', { className: "text-stone-600 dark:text-stone-300" }, "Acreditamos que todos merecem um serviço de qualidade, seja para uma emergência ou para um projeto planeado. Com um sistema de verificação rigoroso e avaliações de clientes, garantimos que encontra sempre o profissional certo para o trabalho.")
                      ),
                      h('div', null, h('img', { src: "https://picsum.photos/seed/office/600/400", alt: "Equipa da IDEA a trabalhar", className: "rounded-lg shadow-xl" }))
                  )
              )
          );
      };
      
      const Footer = () => {
        return h('footer', { id: "contactos", className: "bg-slate-800 dark:bg-slate-950 text-slate-300" },
            h('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8 py-12" },
                h('div', { className: "grid grid-cols-1 md:grid-cols-4 gap-8" },
                    h('div', { className: "md:col-span-2" },
                        h('h3', { className: "text-xl font-bold text-white mb-2" }, "IDEA"),
                        h('p', { className: "text-slate-400 mb-4" }, "Serviços de Urgência 24/7 em Portugal."),
                        h('p', { className: "text-sm text-slate-500" }, "A sua plataforma de confiança para encontrar profissionais verificados para qualquer necessidade, a qualquer momento.")
                    ),
                    h('div', null,
                        h('h4', { className: "font-semibold text-white mb-4" }, "Links Rápidos"),
                        h('ul', { className: "space-y-2" },
                            h('li', null, h('a', { href: "#quem-somos", className: "hover:text-blue-400 transition-colors" }, "Quem Somos")),
                            h('li', null, h('a', { href: "#serviços", className: "hover:text-blue-400 transition-colors" }, "Serviços")),
                            h('li', null, h('a', { href: "#pedir-orcamento", className: "hover:text-blue-400 transition-colors" }, "Registo de Profissional")),
                            h('li', null, h('a', { href: "#", className: "hover:text-blue-400 transition-colors" }, "Termos e Condições"))
                        )
                    ),
                    h('div', null,
                        h('h4', { className: "font-semibold text-white mb-4" }, "Contactos"),
                        h('ul', { className: "space-y-2 text-slate-400" },
                            h('li', { className: "flex items-start" }, h('span', { className: "font-semibold text-slate-200 mr-2" }, "Endereço:"), h('span', null, "Avenida da Liberdade, Lisboa, Portugal")),
                            h('li', { className: "flex items-start" }, h('span', { className: "font-semibold text-slate-200 mr-2" }, "Apoio:"), h('a', { href: "mailto:apoio@idea.pt", className: "hover:text-blue-400" }, "apoio@idea.pt")),
                            h('li', { className: "flex items-start" }, h('span', { className: "font-semibold text-slate-200 mr-2" }, "Telefone:"), h('a', { href: "tel:+351210123456", className: "hover:text-blue-400" }, "+351 210 123 456"))
                        )
                    )
                ),
                h('div', { className: "mt-8 pt-8 border-t border-slate-700 text-center text-sm text-slate-500" },
                    h('p', null, `© ${new Date().getFullYear()} IDEA - Serviços de Urgência. Todos os direitos reservados.`)
                )
            )
        );
      };

      // --- COMPONENTE PRINCIPAL (APP) ---

      const App = () => {
        const [theme, setTheme] = useState('dark');
        const [currentUser, setCurrentUser] = useState(null);
        const [isRegistrationModalOpen, setRegistrationModalOpen] = useState(false);
        const [isLoginModalOpen, setLoginModalOpen] = useState(false);
        const [isProviderProfileModalOpen, setProviderProfileModalOpen] = useState(false);

        const [preselectedService, setPreselectedService] = useState('');

        useEffect(() => {
          const savedTheme = localStorage.getItem('theme') || 'dark';
          setTheme(savedTheme);
        }, []);

        useEffect(() => {
          if (theme === 'dark') {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
          localStorage.setItem('theme', theme);
        }, [theme]);
        
        // Effect to trigger provider profile modal on first login
        useEffect(() => {
          if (currentUser && currentUser.type === 'provider' && !currentUser.profileComplete) {
            setProviderProfileModalOpen(true);
          }
        }, [currentUser]);

        const toggleTheme = () => setTheme(prevTheme => (prevTheme === 'light' ? 'dark' : 'light'));
        
        const handleLogin = (user) => {
            setCurrentUser(user);
            setLoginModalOpen(false);
        };

        const handleLogout = () => setCurrentUser(null);
        
        const handleSaveProfile = (profileData) => {
          setCurrentUser(prev => ({ ...prev, ...profileData, profileComplete: true }));
          console.log("Provider profile saved:", profileData);
        };

        const handleServiceSelection = (serviceName) => {
            setPreselectedService(serviceName);
        };

        const handleFormInteraction = () => {
            setPreselectedService('');
        };

        return h('div', { className: "bg-stone-100 dark:bg-slate-900 text-stone-800 dark:text-stone-200 min-h-screen font-sans transition-colors duration-300" },
          h(Header, { 
            theme: theme, 
            toggleTheme: toggleTheme, 
            onRegisterClick: () => setRegistrationModalOpen(true),
            onLoginClick: () => setLoginModalOpen(true),
            onLogout: handleLogout,
            currentUser: currentUser
          }),
          h('main', null,
            h(Hero),
            h(ServiceCategories, { onServiceSelect: handleServiceSelection }),
            h(HowItWorks),
            h(PriceSimulator),
            h(ProviderListings),
            h(QuoteRequest, { 
              preselectedService: preselectedService, 
              onFormInteracted: handleFormInteraction,
              currentUser: currentUser,
              onLoginPrompt: () => setLoginModalOpen(true)
            }),
            h(Testimonials),
            h(AdBanner),
            h(MapSection),
            h(AboutUs)
          ),
          h(Footer),
          h(RegistrationModal, { isOpen: isRegistrationModalOpen, onClose: () => setRegistrationModalOpen(false) }),
          h(LoginModal, { isOpen: isLoginModalOpen, onClose: () => setLoginModalOpen(false), onLogin: handleLogin }),
          h(ProviderProfileModal, { isOpen: isProviderProfileModalOpen, onClose: () => setProviderProfileModalOpen(false), onSave: handleSaveProfile })
        );
      };

      // --- INICIALIZAÇÃO DO REACT ---
      
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }
      const root = ReactDOM.createRoot(rootElement);
      root.render(h(React.StrictMode, null, h(App)));

    </script>
  </body>
</html>
